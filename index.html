<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Strom - Family Tree</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            /* Light theme (default) */
            --primary: #5a9a5a;
            --primary-dark: #4a8a4a;
            --male: #e3f2fd;
            --male-border: #90caf9;
            --female: #fce4ec;
            --female-border: #f48fb1;
            --placeholder-bg: #f5f5f5;
            --placeholder-border: #999;
            --bg: #f0f0f0;
            --card-bg: #ffffff;
            --text: #333;
            --text-light: #666;
            --shadow: rgba(0,0,0,0.1);
            --line-color: #888;
        }

        [data-theme="dark"] {
            --primary: #6aaa6a;
            --primary-dark: #5a9a5a;
            --male: #1a3a5c;
            --male-border: #2d5a87;
            --female: #4a2a3a;
            --female-border: #6d3d52;
            --placeholder-bg: #2a2a2a;
            --placeholder-border: #555;
            --bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #e0e0e0;
            --text-light: #999;
            --shadow: rgba(0,0,0,0.3);
            --line-color: #666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            touch-action: none;
        }

        /* ==================== TOOLBAR ==================== */
        .toolbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 50px;
            background: var(--card-bg);
            box-shadow: 0 2px 4px var(--shadow);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            z-index: 100;
        }

        .toolbar h1 {
            font-size: 18px;
            font-weight: 600;
            margin-right: 16px;
        }

        .app-logo {
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-block;
        }
        .app-logo:hover {
            transform: scale(1.2);
        }

        .toolbar button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            background: var(--primary);
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toolbar button:hover { background: var(--primary-dark); }
        .toolbar button.secondary {
            background: #e0e0e0;
            color: var(--text);
        }
        .toolbar button.secondary:hover { background: #d0d0d0; }

        /* Round add person button (tablet/mobile) */
        .add-person-round {
            width: 32px;
            height: 32px;
            padding: 0;
            font-size: 22px;
            font-weight: 300;
            line-height: 1;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
        }
        .add-person-round:hover {
            background: var(--primary-dark);
        }

        /* Toolbar focus info (for tablet landscape) */
        .toolbar .toolbar-focus {
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text);
            margin-left: auto;
        }
        .toolbar .toolbar-focus strong {
            font-weight: 600;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .toolbar .toolbar-focus .focus-count {
            color: var(--text-light);
        }
        .toolbar .toolbar-focus .focus-depth {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
        }
        .toolbar .toolbar-focus .focus-depth select {
            padding: 2px 4px;
            font-size: 11px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: var(--bg);
        }

        /* ==================== TREE SWITCHER ==================== */
        .tree-switcher {
            position: relative;
        }
        .tree-switcher-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            max-width: 200px;
        }
        .tree-switcher-btn:hover {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.05);
        }
        .tree-switcher-btn .tree-icon {
            font-size: 16px;
        }
        .tree-switcher-btn .tree-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 120px;
        }
        .tree-switcher-btn .tree-dropdown-arrow {
            color: var(--text-light);
            font-size: 10px;
        }
        .tree-switcher-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            min-width: 220px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            z-index: 200;
            display: none;
        }
        .tree-switcher-dropdown.active {
            display: block;
        }
        .tree-switcher-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background 0.15s;
        }
        .tree-switcher-item:first-child {
            border-radius: 10px 10px 0 0;
        }
        .tree-switcher-item:last-child {
            border-bottom: none;
        }
        .tree-switcher-item:hover {
            background: #f5f5f5;
        }
        .tree-switcher-item.active {
            background: rgba(74, 144, 217, 0.1);
        }
        .tree-switcher-item .tree-item-name {
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .tree-switcher-item .tree-item-check {
            color: var(--primary);
            font-weight: bold;
        }
        .tree-switcher-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 4px 0;
        }
        .tree-switcher-action {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            cursor: pointer;
            color: var(--text-light);
            font-size: 13px;
            transition: all 0.15s;
        }
        .tree-switcher-action:hover {
            background: #f5f5f5;
            color: var(--primary);
        }
        .tree-switcher-action:last-child {
            border-radius: 0 0 10px 10px;
        }

        /* ==================== SEARCH ==================== */
        .search-container {
            position: relative;
            margin-right: auto;
            width: 220px;
        }
        /* Toolbar search picker styling */
        #toolbar-search-picker .person-picker-input {
            padding: 8px 32px 8px 12px;
            font-size: 13px;
        }
        .toolbar #toolbar-search-picker .person-picker-toggle {
            font-size: 10px;
            background: transparent;
            color: var(--text-light);
            padding: 4px;
            border-radius: 4px;
        }
        .toolbar #toolbar-search-picker .person-picker-toggle:hover {
            background: rgba(128,128,128,0.2);
            color: var(--text);
        }
        .search-no-results {
            padding: 12px;
            text-align: center;
            color: var(--text-light);
            font-size: 13px;
        }
        .person-card.highlighted {
            box-shadow: 0 0 0 4px #ffc107, 0 4px 12px rgba(0,0,0,0.15) !important;
            z-index: 50;
        }

        /* ==================== TREE CONTAINER ==================== */
        #tree-container {
            position: absolute;
            top: 50px; left: 0; right: 0; bottom: 0;
            overflow: hidden;
            cursor: grab;
        }
        #tree-container:active { cursor: grabbing; }

        #tree-canvas {
            position: absolute;
            transform-origin: 0 0;
            will-change: transform;
        }

        #tree-lines {
            position: absolute;
            top: 0; left: 0;
            pointer-events: none;
            overflow: visible;
        }
        #tree-lines line,
        #tree-lines path {
            stroke: var(--line-color);
            stroke-width: 2;
        }

        /* ==================== PERSON CARD ==================== */
        .person-card {
            position: absolute;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 8px 12px;
            width: 130px;
            height: 65px;
            box-sizing: border-box;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow);
            cursor: pointer;
            border: 2px solid transparent;
            user-select: none;
            transition: transform 0.15s, box-shadow 0.15s;
            /* Touch device optimizations */
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            /* overflow: visible needed for add-btn positioned outside card bounds */
        }
        .person-card:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .person-card:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px var(--shadow);
        }
        .person-card.male {
            background: var(--male);
            border-color: var(--male-border);
        }
        .person-card.female {
            background: var(--female);
            border-color: var(--female-border);
        }
        .person-card.placeholder {
            background: var(--placeholder-bg);
            border: 2px dashed var(--placeholder-border);
            opacity: 0.85;
        }

        .person-card .name {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 2px;
            max-width: 100%;
        }
        .person-card .name .name-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            max-width: 100%;
        }
        .person-card .name .deceased-marker {
            flex-shrink: 0;
            color: #666;
        }
        .person-card .surname {
            font-size: 12px;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .person-card .birth-date {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Show only year - full date hidden */
        .person-card .date-full { display: none; }
        .person-card .date-year { display: inline; }
        .person-card .deceased {
            opacity: 0.7;
        }

        /* ==================== ZOOM-LEVEL RESPONSIVE ==================== */
        /* Fonts scale naturally with zoom transform - no hiding needed */

        /* ==================== ADD BUTTONS ==================== */
        .add-btn {
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            line-height: 1;
            transition: transform 0.15s, background 0.15s;
        }
        .person-card:hover .add-btn { display: flex; }
        .add-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.15);
        }

        .add-btn.top { top: -11px; left: 50%; transform: translateX(-50%); }
        .add-btn.bottom { bottom: -11px; left: 50%; transform: translateX(-50%); }
        .add-btn.left { left: -11px; top: 50%; transform: translateY(-50%); }
        .add-btn.right { right: -11px; top: 50%; transform: translateY(-50%); }
        .add-btn.top:hover { transform: translateX(-50%) scale(1.15); }
        .add-btn.bottom:hover { transform: translateX(-50%) scale(1.15); }
        .add-btn.left:hover { transform: translateY(-50%) scale(1.15); }
        .add-btn.right:hover { transform: translateY(-50%) scale(1.15); }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 24px;
            min-width: 340px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
        }
        .modal h2 {
            font-size: 17px;
            margin-bottom: 18px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: -24px;
            background: var(--card-bg);
            margin: -24px -24px 18px -24px;
            padding: 24px 24px 12px 24px;
            z-index: 10;
            border-bottom: 1px solid transparent;
        }
        .modal-header h2 {
            margin-bottom: 0;
        }

        /* About modal */
        .about-modal {
            position: relative;
            max-width: 300px;
            text-align: center;
            padding: 20px;
            min-width: auto;
        }
        .about-modal .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .about-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .about-logo {
            font-size: 36px;
        }
        .about-title {
            font-size: 24px;
            font-weight: 600;
        }
        .about-title #about-version {
            color: var(--text-light);
            font-weight: 400;
        }
        .about-description {
            color: var(--text-light);
            margin: 0 0 4px;
            font-size: 12px;
        }
        .about-author {
            margin: 0 0 8px;
            font-size: 12px;
            color: var(--text-light);
        }
        .about-author strong {
            color: var(--text-color);
        }
        .about-meta {
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 16px;
        }
        .about-meta a {
            color: var(--primary);
            text-decoration: none;
        }
        .about-meta span {
            margin: 0 6px;
        }
        .about-stats {
            padding: 12px;
            background: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .about-tree-name {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 6px;
        }
        .about-stats-row {
            font-size: 11px;
            color: var(--text-light);
        }
        .about-stats-total {
            background: #e8f4fd;
            border: 1px solid var(--primary);
        }
        .about-stats-total .about-stats-row {
            font-weight: 500;
            color: var(--text);
        }
        /* Settings modal */
        .settings-modal {
            min-width: 300px;
            max-width: 360px;
        }
        .settings-section {
            margin-bottom: 20px;
        }
        .settings-label {
            display: block;
            font-weight: 500;
            margin-bottom: 12px;
            color: var(--text);
        }
        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .settings-radio {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .settings-radio:hover {
            background: #f5f5f5;
            border-color: var(--primary);
        }
        .settings-radio input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        .settings-radio span {
            font-size: 14px;
            color: var(--text);
        }
        .settings-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .settings-checkbox:hover {
            background: #f5f5f5;
            border-color: var(--primary);
        }
        .settings-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        .settings-checkbox span {
            font-size: 14px;
            color: var(--text);
        }
        .settings-hint {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 10px;
            line-height: 1.4;
        }
        [data-theme="dark"] .settings-radio {
            border-color: #444;
        }
        [data-theme="dark"] .settings-radio:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .settings-checkbox {
            border-color: #444;
        }
        [data-theme="dark"] .settings-checkbox:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .radio-option {
            background: #3a3a3a;
            border-color: #444;
        }
        [data-theme="dark"] .radio-option:hover {
            background: #444;
        }
        /* Audit Log modal */
        .audit-log-modal {
            min-width: 350px;
            max-width: 550px;
            width: 90vw;
        }
        .audit-log-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        .audit-log-list {
            max-height: 60vh;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        .audit-log-entry {
            display: flex;
            align-items: baseline;
            gap: 8px;
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        .audit-log-entry:last-child {
            border-bottom: none;
        }
        .audit-log-time {
            color: var(--text-light);
            font-size: 11px;
            white-space: nowrap;
            min-width: 110px;
        }
        .audit-log-icon {
            font-weight: bold;
            width: 16px;
            text-align: center;
            flex-shrink: 0;
        }
        .audit-log-desc {
            flex: 1;
            word-break: break-word;
        }
        .audit-log-empty {
            text-align: center;
            color: var(--text-light);
            padding: 24px;
        }
        [data-theme="dark"] .audit-log-list {
            border-color: #444;
        }
        [data-theme="dark"] .audit-log-entry {
            border-bottom-color: #333;
        }
        @media (max-width: 500px) {
            .audit-log-modal {
                min-width: auto;
            }
            .audit-log-entry {
                flex-wrap: wrap;
            }
            .audit-log-time {
                width: 100%;
                min-width: auto;
            }
        }

        /* Dark mode overrides for various elements */
        [data-theme="dark"] .mobile-menu button:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .tree-switcher-btn {
            background: var(--card-bg);
            border-color: #444;
        }
        [data-theme="dark"] .tree-switcher-btn:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .tree-switcher-dropdown {
            background: var(--card-bg);
            border-color: #444;
        }
        [data-theme="dark"] .tree-switcher-item {
            border-bottom-color: #444;
        }
        [data-theme="dark"] .tree-switcher-item:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .tree-switcher-divider {
            background: #444;
        }
        [data-theme="dark"] .tree-switcher-action:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .menu-option {
            border-color: #444;
            background: #3a3a3a;
            color: var(--text);
        }
        [data-theme="dark"] .menu-option:hover {
            background: #444;
            border-color: var(--primary);
        }
        [data-theme="dark"] .menu-option .option-title {
            color: var(--text);
        }
        [data-theme="dark"] .menu-option .option-desc {
            color: var(--text-light);
        }
        [data-theme="dark"] .about-stats {
            background: #3a3a3a;
        }
        [data-theme="dark"] .about-stats-total {
            background: #1a3a5c;
            border-color: var(--primary);
        }
        [data-theme="dark"] .stat-item,
        [data-theme="dark"] .import-tree-stats .stat-item,
        [data-theme="dark"] .gedcom-stats .stat-item {
            background: #3a3a3a;
        }
        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            background: #3a3a3a;
            color: var(--text);
            border-color: #555;
        }
        [data-theme="dark"] select option {
            background: #3a3a3a;
            color: var(--text);
        }
        [data-theme="dark"] .form-group input:focus,
        [data-theme="dark"] .form-group select:focus {
            border-color: var(--primary);
        }
        /* Dark mode: toolbar secondary button */
        [data-theme="dark"] .toolbar button.secondary {
            background: #444;
            color: var(--text);
        }
        [data-theme="dark"] .toolbar button.secondary:hover {
            background: #555;
        }
        /* Dark mode: focus controls */
        [data-theme="dark"] .focus-controls {
            background: rgba(42, 42, 42, 0.85);
        }
        [data-theme="dark"] .focus-count {
            background: #444;
            color: var(--text-light);
        }
        [data-theme="dark"] .focus-depth select {
            background: #3a3a3a;
            color: var(--text);
            border-color: #555;
        }
        /* Dark mode: zoom controls */
        [data-theme="dark"] .zoom-controls button {
            background: var(--card-bg);
            color: var(--text);
            border-color: #444;
        }
        [data-theme="dark"] .zoom-controls button:hover {
            background: #3a3a3a;
        }
        /* Dark mode: modal background */
        [data-theme="dark"] .modal {
            background: var(--card-bg);
        }
        /* Dark mode: tree manager items */
        [data-theme="dark"] .tree-manager-item {
            background: #3a3a3a;
            border-color: #555;
        }
        [data-theme="dark"] .tree-manager-item.active {
            border-color: var(--primary);
            background: #2a4a5a;
        }
        [data-theme="dark"] .tree-manager-item-actions button {
            background: #444;
            border-color: #555;
            color: var(--text);
        }
        [data-theme="dark"] .tree-manager-item-actions button:hover {
            background: #555;
            border-color: var(--primary);
            color: var(--primary);
        }
        [data-theme="dark"] .tree-manager-item-actions button.danger {
            background: #444;
            color: #ff6b6b;
        }
        [data-theme="dark"] .tree-manager-item-actions button.danger:hover {
            background: #4a2a2a;
            border-color: #ff6b6b;
        }
        /* Dark mode: secondary buttons in modal */
        [data-theme="dark"] .modal button.secondary {
            background: #444;
            color: var(--text);
            border-color: #555;
        }
        [data-theme="dark"] .modal button.secondary:hover {
            background: #555;
        }
        /* Dark mode: modal footer buttons */
        [data-theme="dark"] .modal-footer button.secondary,
        [data-theme="dark"] .modal-actions button.secondary {
            background: #444;
            color: var(--text);
        }
        [data-theme="dark"] .modal-footer button.secondary:hover,
        [data-theme="dark"] .modal-actions button.secondary:hover {
            background: #555;
        }
        /* Dark mode: Manage Relationships button */
        [data-theme="dark"] .link-relationships-btn {
            background: #3a3a3a;
            border-color: #555;
        }
        [data-theme="dark"] .link-relationships-btn:hover {
            background: rgba(91, 160, 233, 0.15);
            border-color: var(--primary);
        }
        /* Dark mode: close button */
        [data-theme="dark"] .close-btn {
            color: var(--text-light);
        }
        [data-theme="dark"] .close-btn:hover {
            color: var(--text);
        }
        /* Dark mode: empty footer buttons (tree manager) */
        [data-theme="dark"] .tree-manager-footer button:not(.primary) {
            background: #444;
            color: var(--text);
            border-color: #555;
        }
        [data-theme="dark"] .tree-manager-footer button:not(.primary):hover {
            background: #555;
        }
        /* Dark mode: focus controls exit button */
        [data-theme="dark"] .focus-controls .btn-exit-focus {
            background: #444;
            color: var(--text);
        }
        [data-theme="dark"] .focus-controls .btn-exit-focus:hover {
            background: #555;
        }
        /* Dark mode: person picker */
        [data-theme="dark"] .person-picker-input {
            background: #2a2a2a;
            border-color: #444;
            color: var(--text);
        }
        [data-theme="dark"] .person-picker-dropdown {
            background: var(--card-bg);
            border-color: #444;
        }
        [data-theme="dark"] .person-picker-item {
            border-bottom-color: #444;
            color: var(--text);
        }
        [data-theme="dark"] .person-picker-item:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .person-picker-item.selected {
            background: #3a4a5a;
        }
        [data-theme="dark"] .person-picker-empty {
            color: var(--text-light);
        }
        /* Dark mode: context menu */
        [data-theme="dark"] .context-menu {
            background: var(--card-bg);
            border-color: #444;
        }
        [data-theme="dark"] .context-menu button:hover,
        [data-theme="dark"] .context-menu-item:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .context-menu .danger:hover,
        [data-theme="dark"] .context-menu-item.danger:hover {
            background: #4a2a2a;
        }
        [data-theme="dark"] .context-menu-item:active {
            background: #2a2a2a;
        }
        [data-theme="dark"] .context-menu-divider {
            background: #444;
        }
        /* Dark mode: branch tabs */
        [data-theme="dark"] .branch-tabs button {
            background: #3a3a3a;
            border-color: #555;
            color: var(--text);
        }
        [data-theme="dark"] .branch-tabs button:hover {
            background: #444;
        }
        [data-theme="dark"] .branch-tabs button.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        /* Dark mode: hidden partners indicator */
        [data-theme="dark"] .hidden-partners {
            background: #444;
            color: var(--text-light);
        }
        [data-theme="dark"] .hidden-partners:hover {
            background: #555;
        }
        /* Dark mode: relationships panel */
        [data-theme="dark"] .relationships-panel {
            background: var(--card-bg);
        }
        [data-theme="dark"] .relationship-item {
            background: #3a3a3a;
            border-color: #555;
        }
        [data-theme="dark"] .relationship-item:hover {
            background: #444;
        }
        /* Dark mode: rel-item (relationships panel items) */
        [data-theme="dark"] .rel-item {
            background: #3a3a3a;
        }
        [data-theme="dark"] .rel-remove-btn {
            background: #4a2a2a;
        }
        /* Dark mode: validation dialog */
        [data-theme="dark"] .validation-errors,
        [data-theme="dark"] .validation-warnings {
            background: #3a3a3a;
        }
        [data-theme="dark"] .validation-item {
            background: #3a3a3a;
        }
        /* Dark mode: merge dialog */
        [data-theme="dark"] .merge-stats {
            background: #3a3a3a;
        }
        [data-theme="dark"] .merge-tabs .merge-tab {
            background: #3a3a3a;
            border-color: #555;
            color: var(--text);
        }
        [data-theme="dark"] .merge-tabs .merge-tab:hover {
            background: #444;
            border-color: var(--primary);
        }
        [data-theme="dark"] .merge-tabs .merge-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        [data-theme="dark"] .merge-item {
            border-bottom-color: #444;
        }
        [data-theme="dark"] .merge-item:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .merge-item.confirmed {
            background: #1a3a2a;
        }
        [data-theme="dark"] .merge-item.rejected {
            background: #3a2a2a;
        }
        [data-theme="dark"] .merge-item.pending {
            background: #3a3520;
            border-left: 3px solid #ffa000;
        }
        [data-theme="dark"] .merge-item-score {
            background: #444;
            color: var(--text-light);
        }
        [data-theme="dark"] .merge-item-score.confidence-high {
            background: #1a3a2a;
            color: #81c784;
        }
        [data-theme="dark"] .merge-item-score.confidence-medium {
            background: #3a3020;
            color: #ffb74d;
        }
        [data-theme="dark"] .merge-item-score.confidence-low {
            background: #3a2a2a;
            color: #ef9a9a;
        }
        [data-theme="dark"] .merge-item-actions button {
            background: #444;
            border-color: #555;
            color: var(--text);
        }
        [data-theme="dark"] .merge-item-actions button:hover {
            background: #555;
            border-color: var(--primary);
        }
        [data-theme="dark"] .merge-list {
            border-color: #444;
        }
        [data-theme="dark"] .merge-wizard-steps span {
            background: #444;
            color: var(--text-light);
        }
        [data-theme="dark"] .merge-wizard-steps span.active {
            background: var(--primary);
            color: white;
        }
        [data-theme="dark"] .merge-manual-person {
            background: #3a3a3a;
            color: var(--text);
        }
        [data-theme="dark"] .conflict-row {
            border-bottom-color: #444;
        }
        [data-theme="dark"] .conflict-option {
            border-color: #444;
            background: #2a2a2a;
        }
        [data-theme="dark"] .conflict-option:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .conflict-badge {
            background: #444;
            color: var(--text-light);
        }
        [data-theme="dark"] .merge-step {
            background: #444;
        }
        [data-theme="dark"] .merge-trees-option {
            border-color: #444;
            background: #2a2a2a;
        }
        [data-theme="dark"] .merge-trees-option:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .merge-trees-option.selected {
            background: rgba(90, 154, 90, 0.2);
        }
        [data-theme="dark"] .merge-trees-warning {
            background: #3a3020;
            color: #ffb74d;
        }
        [data-theme="dark"] .pending-merge-item {
            background: #3a3a3a;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .stat-item {
            text-align: center;
            padding: 8px 4px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .stat-value {
            display: block;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }
        .stat-label {
            display: block;
            font-size: 10px;
            color: var(--text-light);
            margin-top: 2px;
            text-transform: uppercase;
        }

        /* Link existing button - now in button row */
        #toggle-link-mode.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s;
        }
        .close-btn:hover {
            color: var(--text);
        }

        /* Relationships Panel */
        .rel-section {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }
        .rel-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .rel-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .rel-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            margin-bottom: 4px;
            gap: 8px;
            background: #f8f8f8;
            border-radius: 6px;
        }
        .rel-item-name {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        .rel-item-icon {
            font-size: 16px;
        }
        .rel-remove-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 4px;
            background: #ffebee;
            color: #e53935;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .rel-remove-btn:hover {
            background: #ffcdd2;
        }
        .rel-status-select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 12px;
            cursor: pointer;
            margin-right: 8px;
        }
        .rel-status-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .partnership-note {
            width: 100%;
            padding: 8px;
            margin-top: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            resize: vertical;
            min-height: 40px;
            font-family: inherit;
        }
        .partnership-note:focus {
            outline: none;
            border-color: var(--primary);
        }
        .partnership-note::placeholder {
            color: #aaa;
        }
        .partnership-dates {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .partnership-dates input {
            flex: 1;
            min-width: 100px;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }
        .partnership-dates input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .partnership-primary-label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-light);
            cursor: pointer;
        }
        .partnership-primary-label input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
        }
        .link-relationships-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f8f8;
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .link-relationships-btn:hover {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.1);
            color: var(--primary);
        }
        .rel-add-btn {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 8px;
            border: 2px dashed #ddd;
            border-radius: 6px;
            background: transparent;
            color: var(--text-light);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .rel-add-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(74, 144, 217, 0.05);
        }
        .rel-link-icon {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 4px;
            background: rgba(0,0,0,0.1);
            color: var(--text-light);
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .person-card:hover .rel-link-icon {
            display: flex;
        }
        .rel-link-icon:hover {
            background: var(--primary);
            color: white;
        }

        /* Hidden relationship indicators - above card on left side (mirror of branch tabs on right) */
        .hidden-indicators {
            position: absolute;
            top: -22px;
            left: 25%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            z-index: 5;
        }
        .hidden-partners-btn,
        .hidden-families-btn {
            min-width: 24px;
            height: 16px;
            padding: 0 6px;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 9px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            line-height: 16px;
        }
        .hidden-partners-btn {
            background: #ff9800;
        }
        .hidden-partners-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }
        .hidden-families-btn {
            background: #9c27b0;
        }
        .hidden-families-btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
        }

        /* Shared badge tooltip (used by hidden-partners, hidden-families, branch-tab ◆) */
        .badge-tooltip {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 4px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 10px;
            min-width: 150px;
            max-width: 240px;
            box-shadow: 0 2px 8px var(--shadow);
            font-size: 11px;
            font-weight: normal;
            color: var(--text);
            text-align: left;
            white-space: normal;
            z-index: 9999;
        }
        .hidden-partners-btn:hover .badge-tooltip,
        .hidden-families-btn:hover .badge-tooltip,
        .branch-tab:hover .badge-tooltip {
            display: block;
        }
        .badge-tooltip-header {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-light);
        }
        .badge-tooltip-item {
            padding: 2px 0;
            border-bottom: 1px solid var(--border-light);
            line-height: 1.3;
        }
        .badge-tooltip-item:last-child {
            border-bottom: none;
        }
        .badge-tooltip-name {
            font-weight: 500;
        }
        .badge-tooltip-detail {
            color: var(--text-light);
            font-size: 10px;
        }

        /* ==================== CROSS-TREE BADGE ==================== */
        /* Badge showing person exists in other trees - positioned below card */
        .cross-tree-badge {
            position: absolute;
            bottom: -22px;
            right: 25%;
            transform: translateX(50%);
            background: #4caf50;
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0;
            animation: crossTreeFadeIn 0.3s ease forwards;
            transition: transform 0.15s, background 0.15s;
            z-index: 5;
        }
        @keyframes crossTreeFadeIn {
            from { opacity: 0; transform: translateX(50%) scale(0.8); }
            to { opacity: 1; transform: translateX(50%) scale(1); }
        }
        .cross-tree-badge:hover {
            background: #388e3c;
            transform: translateX(50%) scale(1.1);
            z-index: 9999;
        }

        /* Tooltip container for cross-tree badge */
        .cross-tree-badge .cross-tree-tooltip {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 50%;
            transform: translateX(50%);
            margin-bottom: 4px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 10px;
            min-width: 150px;
            max-width: 220px;
            box-shadow: 0 2px 8px var(--shadow);
            font-size: 11px;
            font-weight: normal;
            color: var(--text);
            text-align: left;
            white-space: normal;
            z-index: 9999;
        }
        .cross-tree-badge:hover .cross-tree-tooltip {
            display: block;
        }
        .cross-tree-tooltip-header {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-light);
        }
        .cross-tree-tooltip-item {
            padding: 2px 0;
            border-bottom: 1px solid var(--border-light);
        }
        .cross-tree-tooltip-item:last-child {
            border-bottom: none;
        }
        .cross-tree-tooltip-tree {
            font-weight: 500;
        }
        .cross-tree-tooltip-person {
            color: var(--text-light);
            font-size: 10px;
        }
        .cross-tree-tooltip-hint {
            margin-top: 6px;
            font-size: 10px;
            color: var(--text-light);
            font-style: italic;
        }

        /* ==================== BRANCH TABS (ouška) ==================== */
        /* Small tabs above person card for navigating between family contexts */
        .branch-tabs {
            position: absolute;
            top: -22px;
            left: 75%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            z-index: 5;
        }
        .branch-tab {
            min-width: 24px;
            height: 16px;
            border: none;
            border-radius: 8px;
            background: #b0bec5;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 9px;
            padding: 0 6px;
            color: #555;
            line-height: 16px;
            letter-spacing: 1px;
        }
        .branch-tab:hover {
            background: #bbb;
            transform: translateY(-2px);
        }
        .branch-tab.active {
            background: var(--primary);
        }
        .branch-tab.active:hover {
            background: var(--primary-dark);
        }
        /* Left tab = navigate to parents (birth family) */
        .branch-tab.tab-parents {
            background: #b0bec5;
        }
        .branch-tab.tab-parents:hover {
            background: #90a4ae;
        }
        /* Right tab = navigate to own family (current view when focused on this person) */
        .branch-tab.tab-family {
            background: #b0bec5;
        }
        .branch-tab.tab-family:hover {
            background: #90a4ae;
        }
        .branch-tab.tab-family.active {
            background: var(--primary);
        }
        /* Branch tabs are always visible (no hover needed) */
        /* Tooltip for branch tabs */
        .branch-tab[title] {
            position: relative;
        }

        .modal .form-group { margin-bottom: 16px; }
        .modal .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        .modal .form-group.half {
            flex: 1;
            margin-bottom: 0;
        }
        .modal .form-error {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(211, 47, 47, 0.1);
            border-radius: 6px;
        }
        .modal .form-warning {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 152, 0, 0.15);
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            color: var(--text);
        }
        .modal .form-warning .warning-icon {
            flex-shrink: 0;
        }
        .modal .optional-hint {
            font-weight: 400;
            color: var(--text-light);
        }
        .expand-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px dashed #ddd;
            border-radius: 8px;
            background: transparent;
            color: var(--text-light);
            font-size: 13px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        .expand-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .expand-btn .expand-icon {
            display: inline-block;
            transition: transform 0.2s;
        }
        .expand-btn.expanded .expand-icon {
            transform: rotate(90deg);
        }
        .extended-fields {
            display: none;
            padding-top: 4px;
        }
        .extended-fields.visible {
            display: block;
        }
        .modal label {
            display: block;
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 6px;
            font-weight: 500;
        }
        .modal input, .modal select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        .modal input:focus, .modal select:focus {
            outline: none;
            border-color: var(--primary);
        }
        /* Make empty date input placeholder very light */
        .modal input[type="date"]::-webkit-datetime-edit-text,
        .modal input[type="date"]::-webkit-datetime-edit-month-field,
        .modal input[type="date"]::-webkit-datetime-edit-day-field,
        .modal input[type="date"]::-webkit-datetime-edit-year-field {
            color: #ccc;
        }
        /* When date has value, show in normal color */
        .modal input[type="date"].has-value::-webkit-datetime-edit-text,
        .modal input[type="date"].has-value::-webkit-datetime-edit-month-field,
        .modal input[type="date"].has-value::-webkit-datetime-edit-day-field,
        .modal input[type="date"].has-value::-webkit-datetime-edit-year-field {
            color: var(--text);
        }

        .modal .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 12px 0;
        }
        .modal .radio-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
            margin-bottom: 0;
        }
        .modal .radio-group input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .modal .buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .modal .buttons.export-buttons {
            justify-content: space-between;
        }
        .modal .buttons.export-buttons button {
            flex: 1;
        }
        .modal button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .modal button.primary {
            background: var(--primary);
            color: white;
        }
        .modal button.primary:hover { background: var(--primary-dark); }
        .modal button.secondary {
            background: #e0e0e0;
            color: var(--text);
        }
        .modal button.secondary:hover { background: #d0d0d0; }
        .modal button.danger {
            background: #e53935;
            color: white;
            margin-right: auto;
        }
        .modal button.danger:hover { background: #c62828; }

        /* ==================== EMPTY STATE ==================== */
        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-light);
        }
        .empty-state h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--text);
        }
        .empty-state p { margin-bottom: 16px; }
        .empty-state button {
            display: block;
            margin: 0 auto 12px auto;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .empty-state button:hover { background: var(--primary-dark); }
        .empty-state button.secondary {
            background: transparent;
            border: 1px solid var(--text-light);
            color: var(--text);
        }
        .empty-state button.secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: transparent;
        }

        /* ==================== NEWER VERSION WARNING ==================== */
        .newer-version-content {
            text-align: left;
            margin-bottom: 20px;
        }
        .warning-message {
            color: #d32f2f;
            font-weight: 500;
            margin-bottom: 12px;
        }
        .warning-detail {
            color: var(--text-light);
            margin-bottom: 16px;
        }
        .version-info {
            background: var(--placeholder-bg);
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        .solution-text {
            color: var(--primary);
            font-weight: 500;
        }
        .buttons .danger {
            background: #ffebee;
            color: #c62828;
        }
        .buttons .danger:hover {
            background: #ffcdd2;
        }
        [data-theme="dark"] .buttons .danger {
            background: #4a2020;
            color: #ef9a9a;
        }
        [data-theme="dark"] .buttons .danger:hover {
            background: #5a2a2a;
        }
        [data-theme="dark"] .warning-message {
            color: #ef5350;
        }

        /* ==================== VIEW MODE ==================== */
        .view-mode-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 200;
            box-shadow: 0 -2px 10px var(--shadow);
        }
        .view-mode-banner.visible {
            display: flex;
        }
        .view-mode-text {
            font-size: 14px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .view-mode-text strong {
            font-weight: 600;
        }
        .view-mode-detail {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 400;
        }
        .view-mode-banner .btn-primary {
            background: white;
            color: var(--primary);
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .view-mode-banner .btn-primary:hover {
            background: #f0f0f0;
            transform: scale(1.02);
        }
        .view-mode-banner .btn-primary[disabled] {
            background: rgba(255,255,255,0.5);
            color: rgba(0,0,0,0.5);
            cursor: not-allowed;
            transform: none;
        }
        .view-mode-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .view-mode-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .view-mode-action-hint {
            font-size: 11px;
            opacity: 0.8;
        }
        .view-mode-link {
            color: white;
            text-decoration: underline;
            font-size: 13px;
            opacity: 0.9;
        }
        .view-mode-link:hover {
            opacity: 1;
        }
        .info-text {
            color: var(--text-light);
            font-size: 13px;
        }

        /* ==================== EMBEDDED MODE ==================== */
        .embedded-mode-banner {
            position: fixed;
            top: 50px;
            left: 0;
            right: 0;
            background: #fff3cd;
            border-bottom: 1px solid #ffc107;
            display: none;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            z-index: 99;
            font-size: 14px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        .embedded-mode-banner.visible {
            display: flex;
        }
        .embedded-mode-icon {
            font-size: 18px;
        }
        .embedded-mode-text {
            flex: 1;
            color: #856404;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .embedded-mode-text strong {
            font-size: 14px;
        }
        .embedded-mode-detail {
            font-size: 12px;
            opacity: 0.85;
        }
        .embedded-mode-info {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            opacity: 0.7;
        }
        .embedded-mode-info:hover {
            opacity: 1;
        }
        .embedded-mode-btn {
            background: #856404;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
        }
        .embedded-mode-btn:hover {
            background: #6d5303;
        }
        .embedded-mode-link {
            color: #856404;
            text-decoration: underline;
            white-space: nowrap;
            font-size: 13px;
        }
        .embedded-mode-link:hover {
            color: #533f03;
        }
        .embedded-mode-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #856404;
            padding: 0 4px;
            line-height: 1;
        }
        .embedded-mode-close:hover {
            color: #533f03;
        }
        [data-theme="dark"] .embedded-mode-banner {
            background: #3d3200;
            border-color: #5c4d00;
        }
        [data-theme="dark"] .embedded-mode-text,
        [data-theme="dark"] .embedded-mode-link,
        [data-theme="dark"] .embedded-mode-close {
            color: #ffc107;
        }
        [data-theme="dark"] .embedded-mode-btn {
            background: #ffc107;
            color: #3d3200;
        }
        [data-theme="dark"] .embedded-mode-btn:hover {
            background: #ffda6a;
        }
        [data-theme="dark"] .embedded-mode-link:hover,
        [data-theme="dark"] .embedded-mode-close:hover {
            color: #ffda6a;
        }
        /* Mobile: stack vertically */
        @media (max-width: 600px) {
            .embedded-mode-banner {
                flex-wrap: wrap;
                padding: 8px 12px;
                gap: 8px;
            }
            .embedded-mode-text {
                flex-basis: calc(100% - 60px);
            }
            .embedded-mode-info {
                order: -1;
            }
            .embedded-mode-btn,
            .embedded-mode-link {
                font-size: 12px;
                padding: 5px 10px;
            }
        }
        /* Embedded info dialog */
        .embedded-info-content {
            margin-bottom: 16px;
        }
        .embedded-info-content p {
            margin: 0 0 12px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        .embedded-info-how {
            margin-top: 16px !important;
        }
        .embedded-info-options {
            margin: 8px 0 0 0;
            padding-left: 24px;
            font-size: 14px;
            line-height: 1.6;
        }
        .embedded-info-options li {
            margin-bottom: 6px;
        }
        .embedded-info-option {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin: 12px 0;
            padding: 10px 12px;
            background: rgba(0,0,0,0.03);
            border-radius: 6px;
        }
        .embedded-info-option strong {
            font-size: 14px;
        }
        [data-theme="dark"] .embedded-info-option {
            background: rgba(255,255,255,0.05);
        }
        #embedded-info-modal .buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        #embedded-info-modal .btn-primary {
            display: inline-block;
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
        }
        #embedded-info-modal .btn-primary:hover {
            background: var(--primary-dark);
        }
        /* Offset content when embedded banner is visible */
        body.embedded-mode .focus-bar {
            top: 90px;
        }

        /* View mode restrictions */
        body.view-mode .edit-only { display: none !important; }
        body.view-mode .person-card { cursor: default; }
        body.view-mode .person-card .add-btn { display: none !important; }
        body.view-mode .person-card .rel-link-icon { display: none !important; }
        body.view-mode #add-person-btn { display: none !important; }
        body.view-mode .add-person-round { display: none !important; }
        body.view-mode .toolbar-buttons { display: none !important; }
        body.view-mode #mobile-menu button[data-i18n="mobileMenu.addPerson"] { display: none !important; }
        body.view-mode .encryption-section { display: none !important; }
        body.view-mode .tree-manager-footer .edit-only { display: none !important; }
        body.view-mode .tree-manager-item-actions .edit-only { display: none !important; }
        body.view-mode .tree-switcher-action { display: none !important; }
        body.view-mode .tree-switcher-divider { display: none !important; }
        body.view-mode .empty-state button { display: none !important; }

        /* Existing export tree name */
        .existing-tree-name,
        .import-tree-name {
            font-weight: 600;
            color: var(--primary);
            margin: 8px 0 16px 0;
        }

        /* Vertical buttons layout */
        .buttons.vertical {
            flex-direction: column;
            gap: 10px;
        }
        .buttons.vertical button {
            width: 100%;
        }

        /* ==================== ZOOM CONTROLS ==================== */
        .zoom-controls {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        .zoom-controls button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: var(--card-bg);
            box-shadow: 0 2px 8px var(--shadow);
            font-size: 22px;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s, background 0.1s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        .zoom-controls button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .zoom-controls button:active {
            transform: scale(0.95);
            background: var(--primary);
            color: white;
        }

        /* ==================== FOCUS MODE ==================== */
        .person-card.focused {
            box-shadow: 0 0 0 4px var(--primary), 0 4px 12px var(--shadow);
            transform: scale(1.05);
        }
        .person-card.focused:hover {
            transform: scale(1.07);
        }

        .focus-controls {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            align-items: center;
            gap: 16px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 16px var(--shadow);
            z-index: 150;
        }
        .focus-info {
            font-size: 13px;
            color: var(--text);
        }
        .focus-info strong {
            color: var(--primary);
        }
        .focus-count {
            margin-left: 12px;
            padding: 2px 8px;
            background: #e0e0e0;
            border-radius: 10px;
            font-size: 11px;
            color: var(--text-light);
        }
        .focus-depth {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-light);
        }
        .focus-depth label {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .focus-depth select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        .focus-controls .btn-export-focus {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            background: var(--primary);
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .focus-controls .btn-export-focus:hover {
            background: var(--primary-dark);
        }
        .focus-controls .btn-exit-focus {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            background: #e0e0e0;
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .focus-controls .btn-exit-focus:hover {
            background: #d0d0d0;
        }

        #file-input { display: none; }

        /* ==================== CONTEXT MENU ==================== */
        .context-menu {
            position: fixed;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 8px 0;
            min-width: 180px;
            z-index: 300;
            animation: fadeIn 0.15s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            transition: background 0.15s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        .context-menu-item:hover {
            background: #f0f0f0;
        }
        .context-menu-item:active {
            background: #e0e0e0;
        }
        .context-menu-item.danger {
            color: #e53935;
        }
        .context-menu-item.danger:hover {
            background: #ffebee;
        }
        .context-menu-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 6px 0;
        }

        /* ==================== STACKED DIALOGS ==================== */
        /* Dialogs that can appear above tree-manager */
        #gedcom-result-modal,
        #import-tree-modal,
        #new-tree-menu-modal,
        #new-tree-modal,
        #merge-modal,
        #pending-merge-modal {
            z-index: 300;  /* Above tree-manager (200), below confirmation (500) */
        }

        /* ==================== CONFIRMATION MODAL ==================== */
        #confirmation-modal {
            z-index: 500;  /* Above other modals (200) */
        }
        #password-prompt-modal {
            z-index: 500;  /* Above other modals (200) */
        }
        #export-password-modal {
            z-index: 500;  /* Above other modals (200) */
        }
        #validation-modal {
            z-index: 500;  /* Above other modals (200) */
        }
        #confirmation-modal .modal {
            max-width: 420px;
        }
        #confirmation-modal h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #confirmation-modal h2 .dialog-icon {
            font-size: 24px;
            line-height: 1;
        }
        #confirmation-modal.dialog-info h2 .dialog-icon { color: var(--primary); }
        #confirmation-modal.dialog-warning h2 .dialog-icon { color: #f0a030; }
        #confirmation-modal.dialog-error h2 .dialog-icon { color: #dc3545; }
        #confirmation-modal.dialog-confirm h2 .dialog-icon { color: var(--primary); }
        #confirmation-modal .confirm-message {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--text);
            white-space: pre-wrap;
        }
        #confirmation-modal .confirm-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        #confirmation-modal .prompt-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        #confirmation-modal .prompt-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        [data-theme="dark"] #confirmation-modal .prompt-input {
            background: #2a2a2a;
            border-color: #444;
            color: var(--text);
        }
        #confirmation-modal .confirm-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
        }
        #confirmation-modal .confirm-option:hover {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.05);
        }
        #confirmation-modal .confirm-option.selected {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.1);
        }
        #confirmation-modal .confirm-option input[type="radio"] {
            width: auto;
            margin: 0;
        }

        /* ==================== RESPONSIVE ==================== */
        .toolbar-buttons { display: flex; gap: 8px; }
        .desktop-only { display: flex; }
        .mobile-only { display: none !important; }

        /* Hamburger button */
        .toolbar .hamburger-btn {
            width: 44px;
            height: 44px;
            padding: 0;
            border: none;
            background: transparent;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        .toolbar .hamburger-btn:hover { background: rgba(128,128,128,0.2); }

        /* Mobile menu */
        .mobile-menu {
            position: fixed;
            top: 50px;
            right: 0;
            background: var(--card-bg);
            box-shadow: -4px 4px 16px var(--shadow);
            padding: 8px;
            display: none;
            flex-direction: column;
            gap: 4px;
            z-index: 150;
            border-radius: 0 0 0 12px;
        }
        .mobile-menu.active { display: flex; }
        .mobile-menu button {
            padding: 12px 20px;
            border: none;
            background: transparent;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            color: var(--text);
        }
        .mobile-menu button:hover { background: #f0f0f0; }

        /* Menu modal (Export/Import dialog) */
        .menu-modal {
            min-width: 300px;
            max-width: 360px;
        }
        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .menu-intro {
            padding: 0 16px 12px 16px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
        }
        .menu-intro p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.4;
        }
        .menu-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
            cursor: pointer;
            text-align: left;
            transition: all 0.15s;
        }
        .menu-option:hover {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.05);
        }
        .option-icon { font-size: 24px; }
        .option-text { display: flex; flex-direction: column; }
        .option-title { font-weight: 500; font-size: 14px; }
        .option-desc { font-size: 12px; color: var(--text-light); }

        /* GEDCOM result dialog */
        .gedcom-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        .gedcom-stats .stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }
        .gedcom-stats .number {
            font-size: 28px;
            font-weight: 600;
            color: var(--primary);
        }
        .gedcom-stats .number.skipped {
            color: #ff9800;
        }
        .gedcom-stats .label {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* Disabled menu option */
        .menu-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .menu-option.disabled:hover {
            border-color: #e0e0e0;
            background: #fafafa;
        }

        /* Save current dialog */
        .save-current-message {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        #gedcom-input, #html-input { display: none; }

        /* ==================== MERGE MODAL ==================== */
        .merge-modal {
            max-width: 700px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }
        .merge-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .merge-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .merge-stat-label {
            font-size: 11px;
            color: var(--text-light);
        }
        .merge-stat-value {
            font-size: 20px;
            font-weight: 600;
        }
        .merge-stat.highlight .merge-stat-value {
            color: #4caf50;
        }
        .merge-stat.warning .merge-stat-value {
            color: #ff9800;
        }
        .merge-stat.new .merge-stat-value {
            color: var(--primary);
        }
        .merge-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .merge-tab {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .merge-tab:hover {
            border-color: var(--primary);
        }
        .merge-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        .tab-count {
            display: inline-block;
            padding: 0 6px;
            margin-left: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            font-size: 10px;
        }
        .merge-tab.active .tab-count {
            background: rgba(255,255,255,0.3);
        }
        .merge-match-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 16px;
            max-height: 400px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .merge-item {
            padding: 12px 14px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.15s;
        }
        .merge-item:last-child {
            border-bottom: none;
        }
        .merge-item:hover {
            background: #f5f5f5;
        }
        .merge-item.confirmed {
            background: #e8f5e9;
        }
        .merge-item.rejected {
            background: #ffebee;
            opacity: 0.7;
        }
        .merge-item.pending {
            background: #fff8e1;
            border-left: 3px solid #ffa000;
        }
        .merge-item-header {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .merge-item-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: #e0e0e0;
            flex-shrink: 0;
        }
        .merge-item-status.confirmed {
            background: #4caf50;
            color: white;
        }
        .merge-item-status.rejected {
            background: #e53935;
            color: white;
        }
        .merge-item-status.new {
            background: var(--primary);
            color: white;
        }
        .merge-item-status.pending {
            background: #ffa000;
            color: white;
        }
        .merge-item-names {
            flex: 1;
            font-size: 14px;
            min-width: 0;
        }
        .merge-item-score {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background: #e0e0e0;
        }
        .merge-item-score.confidence-high {
            background: #c8e6c9;
            color: #2e7d32;
        }
        .merge-item-score.confidence-medium {
            background: #fff3e0;
            color: #ef6c00;
        }
        .merge-item-score.confidence-low {
            background: #ffebee;
            color: #c62828;
        }
        .merge-item-reasons {
            font-size: 11px;
            color: #666;
            margin: 4px 0 4px 24px;
            font-style: italic;
        }
        [data-theme="dark"] .merge-item-reasons {
            color: #999;
        }
        .merge-item-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .merge-item-badge.new {
            background: #e3f2fd;
            color: var(--primary);
        }
        .conflict-indicator {
            color: #ff9800;
            font-size: 14px;
        }
        .merge-item-conflicts {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            font-size: 11px;
        }
        .conflict-field {
            padding: 2px 8px;
            background: #fff3e0;
            border-radius: 4px;
            color: #ef6c00;
        }
        .merge-item-actions {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }
        .merge-item-actions button {
            padding: 5px 10px;
            font-size: 11px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.15s;
        }
        .merge-item-actions button:hover {
            border-color: var(--primary);
        }
        .merge-btn-confirm.active {
            background: #4caf50;
            border-color: #4caf50;
            color: white;
        }
        .merge-btn-reject.active {
            background: #e53935;
            border-color: #e53935;
            color: white;
        }
        .merge-empty {
            padding: 40px;
            text-align: center;
            color: var(--text-light);
        }
        .merge-actions {
            justify-content: flex-end;
        }
        .merge-manual-person {
            padding: 10px 12px;
            background: #f5f5f5;
            border-radius: 6px;
            font-weight: 500;
            flex: 1;
        }
        .merge-btn-preview-wide {
            min-width: 40px;
            font-size: 16px;
        }
        /* Person merge dialog */
        .person-merge-person {
            padding: 10px 12px;
            background: #f5f5f5;
            border-radius: 6px;
            font-weight: 500;
        }
        .person-merge-person.other {
            background: #fff3cd;
        }
        [data-theme="dark"] .person-merge-person {
            background: #3a3a3a;
            color: var(--text);
        }
        [data-theme="dark"] .person-merge-person.other {
            background: #4a4020;
        }
        .person-merge-preview {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }
        [data-theme="dark"] .person-merge-preview {
            border-top-color: #444;
        }
        .person-merge-warning {
            margin-top: 12px;
            padding: 10px 12px;
            background: #fff3cd;
            border-radius: 6px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        [data-theme="dark"] .person-merge-warning {
            background: #4a4020;
            color: #ffb74d;
        }
        .person-merge-conflicts {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }
        [data-theme="dark"] .person-merge-conflicts {
            border-top-color: #444;
        }
        .person-merge-conflicts h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text);
        }
        .person-merge-no-conflicts {
            margin-top: 16px;
            padding: 12px;
            background: #d4edda;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #155724;
        }
        [data-theme="dark"] .person-merge-no-conflicts {
            background: #1e3a1e;
            color: #81c784;
        }
        .person-merge-conflict-row {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        [data-theme="dark"] .person-merge-conflict-row {
            background: #2a2a2a;
        }
        .person-merge-conflict-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        .person-merge-conflict-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .person-merge-conflict-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .person-merge-conflict-option:hover {
            background: #f0f0f0;
        }
        .person-merge-conflict-option input[type="radio"] {
            margin: 0;
        }
        .person-merge-conflict-option.selected {
            border-color: var(--primary);
            background: rgba(90, 154, 90, 0.1);
        }
        [data-theme="dark"] .person-merge-conflict-option {
            border-color: #444;
            background: #2a2a2a;
        }
        [data-theme="dark"] .person-merge-conflict-option:hover {
            background: #3a3a3a;
        }
        [data-theme="dark"] .person-merge-conflict-option.selected {
            background: rgba(90, 154, 90, 0.2);
        }
        .person-merge-conflict-value {
            flex: 1;
        }
        .person-merge-conflict-badge {
            font-size: 11px;
            padding: 2px 6px;
            background: #e0e0e0;
            border-radius: 3px;
            color: var(--text-light);
        }
        [data-theme="dark"] .person-merge-conflict-badge {
            background: #444;
        }
        .merge-conflict-content {
            max-height: 400px;
            overflow-y: auto;
        }
        .conflict-row {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .conflict-row:last-child {
            border-bottom: none;
        }
        .conflict-label {
            font-weight: 500;
            margin-bottom: 8px;
        }
        .conflict-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .conflict-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .conflict-option:hover {
            border-color: var(--primary);
        }
        .conflict-option input[type="radio"] {
            width: auto;
            margin: 0;
        }
        .conflict-value {
            flex: 1;
        }
        .conflict-badge {
            font-size: 10px;
            padding: 2px 6px;
            background: #e0e0e0;
            border-radius: 4px;
        }
        .validation-content {
            max-height: 300px;
            overflow-y: auto;
        }
        .validation-section {
            margin-bottom: 16px;
        }
        .validation-section-title {
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .validation-section-title.errors {
            color: #e53935;
        }
        .validation-section-title.warnings {
            color: #ff9800;
        }
        .validation-item {
            padding: 6px 12px;
            margin-bottom: 4px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 13px;
        }

        /* Merge wizard header */
        .merge-wizard-explanation {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .merge-progress {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .merge-step {
            padding: 6px 12px;
            font-size: 12px;
            background: #e0e0e0;
            border-radius: 16px;
            color: var(--text-light);
            transition: all 0.2s;
        }
        .merge-step.active {
            background: var(--primary);
            color: white;
        }
        .merge-step.complete {
            background: #4caf50;
            color: white;
        }

        /* Merge close confirmation */
        .merge-close-message {
            font-size: 14px;
            margin-bottom: 20px;
            color: var(--text);
        }
        .merge-close-buttons {
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Merge resolve button */
        .merge-btn-resolve {
            background: #fff3e0 !important;
            border-color: #ff9800 !important;
            color: #ef6c00 !important;
        }
        .merge-btn-resolve:hover {
            background: #ffe0b2 !important;
        }

        /* ==================== TREE MANAGER ==================== */
        .tree-manager-modal {
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .tree-manager-footer {
            display: flex;
            gap: 8px;
            justify-content: flex-start;
            align-items: center;
        }
        .tree-manager-footer button {
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .tree-manager-footer button.primary {
            font-size: 13px;
        }
        .tree-manager-list {
            margin-bottom: 16px;
            overflow: visible;
        }
        .tree-manager-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.15s;
        }
        .tree-manager-item.active {
            border-color: var(--primary);
            background: rgba(74, 144, 217, 0.05);
        }
        .tree-manager-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .tree-manager-item-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ccc;
            flex-shrink: 0;
        }
        .tree-manager-item.active .tree-manager-item-indicator {
            background: var(--primary);
        }
        .tree-manager-item.pending-merge {
            border-style: dashed;
            background: rgba(255, 193, 7, 0.05);
        }
        .tree-manager-item.pending-merge .tree-manager-item-indicator {
            background: #ffc107;
        }
        .tree-manager-item.pending-merge .tree-manager-item-indicator.pending {
            background: #ffc107;
        }
        [data-theme="dark"] .tree-manager-item.pending-merge {
            background: rgba(255, 193, 7, 0.1);
        }
        .tree-manager-item.hidden-tree {
            opacity: 0.7;
        }
        .tree-manager-item-name {
            flex: 1;
            font-weight: 500;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .tree-manager-item-stats {
            font-size: 12px;
            color: var(--text-light);
        }
        .tree-manager-item-size {
            font-size: 10px;
            color: var(--text-light);
            opacity: 0.7;
            flex-shrink: 0;
            margin-left: auto;
        }
        .tree-manager-item-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        .tree-manager-item-actions button {
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.15s;
            min-width: 36px;
            height: 32px;
            line-height: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        .tree-manager-item-actions button:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .tree-manager-item-actions button.danger {
            background: white;
            color: #e53935;
        }
        .tree-manager-item-actions button.danger:hover {
            border-color: #e53935;
            background: #ffebee;
        }
        /* Desktop: footer shows icon + text, items show only icons */
        .tree-manager-footer .btn-icon {
            display: inline;
            font-size: 14px;
        }
        .tree-manager-footer .btn-text {
            display: inline;
        }
        .tree-manager-item-actions .btn-icon {
            display: inline;
            font-size: 16px;
        }
        .tree-manager-item-actions .btn-text {
            display: none;
        }
        /* Tree stats dialog - Desktop default */
        .tree-stats-modal {
            min-width: 500px;
            max-width: 600px;
        }
        .tree-stats-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .tree-stats-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .tree-stats-header {
            display: flex;
            justify-content: space-around;
            text-align: center;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary), #7aba7a);
            border-radius: 10px;
            color: white;
        }
        .tree-stats-header-item {
            flex: 1;
        }
        .tree-stats-header-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1.1;
        }
        .tree-stats-header-label {
            font-size: 11px;
            opacity: 0.9;
        }
        .tree-stats-section {
            background: #f8f8f8;
            border-radius: 8px;
            padding: 10px 12px;
        }
        [data-theme="dark"] .tree-stats-section {
            background: #2a2a2a;
        }
        .tree-stats-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: var(--text-light);
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid #e0e0e0;
        }
        [data-theme="dark"] .tree-stats-section-title {
            border-bottom-color: #444;
        }
        .tree-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px 16px;
        }
        .tree-stats-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 3px 0;
        }
        .tree-stats-row .label {
            color: var(--text-light);
        }
        .tree-stats-row .value {
            font-weight: 500;
            text-align: right;
        }
        .tree-stats-anniversaries {
            /* No nested scroll - dialog itself scrolls */
        }
        .tree-stats-anniversary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 13px;
            border-bottom: 1px solid #eee;
        }
        .tree-stats-anniversary:last-child {
            border-bottom: none;
        }
        [data-theme="dark"] .tree-stats-anniversary {
            border-bottom-color: #333;
        }
        .tree-stats-anniversary-icon {
            font-size: 16px;
            flex-shrink: 0;
        }
        .tree-stats-anniversary-info {
            flex: 1;
            min-width: 0;
        }
        .tree-stats-anniversary-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .tree-stats-anniversary-detail {
            font-size: 11px;
            color: var(--text-light);
        }
        .tree-stats-anniversary-date {
            font-size: 11px;
            color: var(--text-light);
            flex-shrink: 0;
        }
        .tree-stats-anniversary-today {
            background: rgba(74, 144, 217, 0.1);
            margin: 0 -12px;
            padding: 6px 12px;
            border-radius: 4px;
        }
        .tree-stats-none {
            color: var(--text-light);
            font-size: 13px;
            text-align: center;
            padding: 12px;
        }

        /* Validation dialog */
        .validation-modal {
            min-width: 500px;
            max-width: 650px;
        }
        .validation-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }
        .validation-passed {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 32px;
        }
        .validation-passed-icon {
            font-size: 48px;
        }
        .validation-passed-text {
            font-size: 16px;
            color: var(--primary);
            font-weight: 500;
        }
        .validation-summary {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px 16px;
            justify-content: center;
            padding: 12px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        [data-theme="dark"] .validation-summary {
            background: #2a2a2a;
        }
        .validation-count {
            font-size: 14px;
            font-weight: 500;
        }
        .validation-count.error {
            color: #d9534f;
        }
        .validation-count.warning {
            color: #f0ad4e;
        }
        .validation-count.info {
            color: #5bc0de;
        }
        .validation-issues {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .validation-issue {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: #fff5f5;
            border-radius: 6px;
            border-left: 3px solid #d9534f;
        }
        [data-theme="dark"] .validation-issue {
            background: #2a2020;
        }
        .validation-issue.warning {
            background: #fffaf0;
            border-left-color: #f0ad4e;
        }
        [data-theme="dark"] .validation-issue.warning {
            background: #2a2820;
        }
        .validation-issue.info {
            background: #f0f8ff;
            border-left-color: #5bc0de;
        }
        [data-theme="dark"] .validation-issue.info {
            background: #202830;
        }
        .validation-issue-icon {
            font-size: 16px;
            flex-shrink: 0;
        }
        .validation-issue-content {
            flex: 1;
            min-width: 0;
        }
        .validation-issue-message {
            font-size: 13px;
            line-height: 1.4;
        }
        .validation-issue-persons {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        .validation-person-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
        }
        .validation-person-link:hover {
            text-decoration: underline;
        }
        .validation-fix-btn {
            padding: 2px 8px;
            font-size: 11px;
            border: 1px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            align-self: center;
        }
        .validation-fix-btn:hover {
            background: var(--primary);
            color: #fff;
        }
        .validation-fix-all-btn {
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--primary);
            background: var(--primary);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
        }
        .validation-fix-all-btn:hover {
            opacity: 0.9;
        }

        /* Merge trees dialog */
        .merge-trees-description {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 16px;
        }
        .merge-trees-options {
            margin-bottom: 16px;
        }
        .merge-trees-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.15s;
        }
        .merge-trees-option:hover {
            border-color: var(--primary);
        }
        .merge-trees-option.selected {
            border-color: var(--primary);
            background: rgba(90, 154, 90, 0.1);
        }
        .merge-trees-option input[type="radio"] {
            width: auto;
            margin: 0;
        }
        .merge-trees-option-info {
            flex: 1;
        }
        .merge-trees-option-name {
            font-weight: 500;
        }
        .merge-trees-option-stats {
            font-size: 12px;
            color: var(--text-light);
        }
        .merge-trees-warning {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #fff3e0;
            border-radius: 6px;
            font-size: 13px;
            color: #ef6c00;
            margin-bottom: 16px;
        }

        /* Default person dialog */
        .modal-description {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 16px;
        }

        /* Default person/tree radio options */
        .default-options {
            margin-bottom: 16px;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            margin-bottom: 4px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }
        .radio-option:hover {
            background: #f0f0f0;
        }
        .radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        .radio-option span {
            font-size: 14px;
        }
        .picker-container {
            margin-left: 24px;
            margin-top: 4px;
            margin-bottom: 8px;
        }
        .tree-select {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }

        .default-person-current {
            font-size: 13px;
            color: var(--text-light);
            padding: 8px 0;
            margin-bottom: 8px;
        }

        /* Import tree dialog */
        .import-tree-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
            text-align: center;
        }
        .import-tree-stats .stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }
        .import-tree-stats .number {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
        }
        .import-tree-stats .label {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* ==================== TREE PREVIEW OVERLAY ==================== */
        .tree-preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 500;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.2s ease;
        }
        .tree-preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--shadow);
            flex-shrink: 0;
        }
        .tree-preview-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .tree-preview-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        .tree-preview-subtitle {
            font-size: 12px;
            color: var(--text-light);
        }
        .tree-preview-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            font-size: 28px;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        .tree-preview-close:hover {
            background: rgba(0,0,0,0.1);
            color: var(--text);
        }
        .tree-preview-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            touch-action: none;
        }
        .tree-preview-canvas {
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: 0 0;
            will-change: transform;
        }
        .tree-preview-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transform-origin: 0 0;
            overflow: visible;
        }
        .tree-preview-line {
            stroke: var(--line-color);
            stroke-width: 2;
            fill: none;
        }
        .tree-preview-line.couple {
            stroke-width: 3;
        }
        .tree-preview-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background: var(--card-bg);
            border-top: 1px solid var(--shadow);
            flex-shrink: 0;
        }
        .tree-preview-focus-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        .tree-preview-focus-label {
            color: var(--text-light);
        }
        .tree-preview-focus-name {
            font-weight: 600;
            color: var(--text);
        }
        .tree-preview-zoom-controls {
            display: flex;
            gap: 8px;
        }
        .tree-preview-zoom-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--bg);
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.15s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .tree-preview-zoom-btn:hover {
            background: var(--primary);
            color: white;
        }
        .tree-preview-zoom-btn:active {
            transform: scale(0.95);
        }

        /* Preview person cards */
        .tree-preview-card {
            position: absolute;
            width: 120px;
            height: 60px;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 6px 8px;
            box-sizing: border-box;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow);
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.15s, box-shadow 0.15s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        .tree-preview-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .tree-preview-card:active {
            transform: scale(0.98);
        }
        .tree-preview-card.male {
            background: var(--male);
            border-color: var(--male-border);
        }
        .tree-preview-card.female {
            background: var(--female);
            border-color: var(--female-border);
        }
        .tree-preview-card.placeholder {
            background: var(--placeholder-bg);
            border-color: var(--placeholder-border);
            border-style: dashed;
        }
        .tree-preview-card.focused {
            box-shadow: 0 0 0 3px var(--primary), 0 4px 12px var(--shadow);
        }
        .preview-card-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .preview-card-surname {
            font-size: 11px;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .preview-card-year {
            font-size: 10px;
            color: var(--text-light);
            margin-top: 2px;
        }

        /* Compact cards for comparison view */
        .tree-preview-card.compact {
            padding: 4px 6px;
        }
        .tree-preview-card.compact .preview-card-name {
            font-size: 12px;
        }
        .tree-preview-card.compact .preview-card-surname {
            font-size: 10px;
        }

        /* ==================== TREE COMPARE OVERLAY ==================== */
        .tree-compare-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 500;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.2s ease;
        }
        .tree-compare-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--shadow);
            flex-shrink: 0;
        }
        .tree-compare-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        .tree-compare-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        .tree-compare-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        .tree-compare-pane-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg);
            border-bottom: 1px solid var(--shadow);
            flex-shrink: 0;
        }
        .tree-compare-pane-header .pane-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .tree-compare-pane-header .pane-subtitle {
            font-size: 11px;
            color: var(--text-light);
        }
        .tree-compare-pane-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            touch-action: none;
            background: var(--bg);
        }
        .tree-compare-pane-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            background: var(--card-bg);
            border-top: 1px solid var(--shadow);
            flex-shrink: 0;
        }
        .tree-compare-pane-footer .tree-preview-focus-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text);
        }
        .tree-compare-pane-footer .tree-preview-zoom-btn {
            width: 28px;
            height: 28px;
            font-size: 16px;
        }
        .tree-compare-divider {
            width: 4px;
            background: var(--primary);
            flex-shrink: 0;
        }

        /* Mobile responsive for comparison */
        @media (max-width: 768px) {
            .tree-compare-content {
                flex-direction: column;
            }
            .tree-compare-divider {
                width: auto;
                height: 4px;
            }
            .tree-compare-pane {
                flex: 1;
                min-height: 0;
            }
        }

        /* Mobile responsive for preview */
        @media (max-width: 600px) {
            .tree-preview-header {
                padding: 10px 16px;
            }
            .tree-preview-title {
                font-size: 14px;
            }
            .tree-preview-footer {
                padding: 8px 16px;
            }
            .tree-preview-focus-info {
                font-size: 12px;
            }
            .tree-preview-zoom-btn {
                width: 40px;
                height: 40px;
            }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 12px 24px;
            background: #333;
            color: white;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Pending merge dialog */
        .pending-merge-message {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 16px;
        }
        .pending-merge-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .pending-merge-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            gap: 12px;
        }
        .pending-merge-info {
            flex: 1;
        }
        .pending-merge-name {
            font-weight: 500;
            font-size: 14px;
        }
        .pending-merge-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }
        .pending-merge-actions {
            display: flex;
            gap: 8px;
        }
        .pending-merge-actions button {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-resume {
            background: var(--primary);
            color: white;
        }
        .btn-resume:hover {
            background: var(--primary-dark);
        }
        .btn-discard {
            background: #ffebee;
            color: #e53935;
        }
        .btn-discard:hover {
            background: #ffcdd2;
        }

        /* ==================== PERSON PICKER ==================== */
        .person-picker {
            position: relative;
        }
        .person-picker-input {
            width: 100%;
            padding: 10px 32px 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        .person-picker-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .person-picker-toggle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-light);
            font-size: 12px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }
        .person-picker-toggle:hover {
            color: var(--text);
        }
        .person-picker-dropdown {
            position: fixed;
            max-height: 250px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1100;
            display: none;
        }
        .person-picker-dropdown.active {
            display: block;
        }
        .person-picker-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            transition: background 0.15s;
        }
        .person-picker-item:last-child {
            border-bottom: none;
        }
        .person-picker-item:hover,
        .person-picker-item.selected {
            background: #f0f7ff;
        }
        .person-picker-item .birth-year {
            color: var(--text-light);
            font-size: 12px;
            margin-left: 4px;
        }
        .person-picker-empty {
            padding: 16px;
            text-align: center;
            color: var(--text-light);
            font-size: 13px;
        }
        .person-picker-loading {
            padding: 8px;
            text-align: center;
            color: var(--text-light);
            font-size: 14px;
        }

        /* Tablet (600px-1024px): focus info in toolbar, round + button, hide floating */
        @media (min-width: 600px) and (max-width: 1024px) {
            .toolbar .toolbar-focus {
                display: flex;
            }
            .toolbar-buttons {
                display: none !important;
            }
            .add-person-round {
                display: flex !important;
            }
            .focus-controls {
                display: none !important;
            }
            .search-container {
                max-width: 200px;
            }
            /* Compact tree switcher on tablet */
            .tree-switcher {
                display: block !important;
            }
            .tree-switcher-btn {
                padding: 6px 10px;
            }
            .tree-switcher-btn .tree-name {
                max-width: 80px;
            }
            .toolbar > button.secondary {
                display: none !important;
            }
            .hamburger-btn {
                display: flex !important;
            }
        }

        @media (max-width: 600px) {
            .desktop-only { display: none !important; }
            .mobile-only { display: flex !important; }

            .toolbar-title { display: none; }
            /* Smaller search, make room for tree switcher */
            .search-container {
                flex: 0 1 auto;
                max-width: 140px;
                min-width: 100px;
            }
            #toolbar-search-picker { width: 100%; }

            /* Compact tree switcher on mobile */
            .tree-switcher {
                display: block !important;
                flex-shrink: 0;
            }
            .tree-switcher-btn {
                padding: 6px 8px;
                gap: 4px;
            }
            .tree-switcher-btn .tree-icon {
                font-size: 14px;
            }
            .tree-switcher-btn .tree-name {
                max-width: 60px;
                font-size: 12px;
            }
            .tree-switcher-btn .tree-dropdown-arrow {
                font-size: 8px;
            }
            .tree-switcher-dropdown {
                right: 0;
                left: auto;
                min-width: 200px;
            }

            /* Show round + button on mobile */
            .add-person-round {
                display: flex !important;
            }

            /* Larger zoom controls on mobile for better touch targets */
            .zoom-controls {
                bottom: 16px;
                right: 16px;
                gap: 8px;
            }
            .zoom-controls button {
                width: 48px;
                height: 48px;
                font-size: 24px;
            }
        }

        /* Tablet/Mobile (≤1024px): icons in tree manager */
        @media (max-width: 1024px) {
            .tree-manager-item-actions .btn-icon,
            .tree-manager-footer .btn-icon {
                display: inline !important;
            }
            .tree-manager-item-actions .btn-text,
            .tree-manager-footer .btn-text {
                display: none !important;
            }
            .tree-manager-item-actions button {
                padding: 6px 8px;
                min-width: auto;
            }
            /* Better scroll for tree manager on mobile */
            .tree-manager-modal {
                max-height: 90vh;
                display: flex;
                flex-direction: column;
                padding: 12px;
                overflow: hidden;
            }
            .tree-manager-modal .modal-header {
                margin: -12px -12px 8px -12px;
                padding: 12px 12px 8px 12px;
                flex-shrink: 0;
            }
            .tree-manager-modal .modal-header h2 {
                font-size: 16px;
            }
            .tree-manager-list {
                flex: 1 1 auto;
                max-height: none;
                overflow-y: auto;
                min-height: 100px;
            }
            .tree-manager-footer {
                flex-shrink: 0;
            }
            .tree-manager-item {
                padding: 10px;
                margin-bottom: 8px;
            }
            /* Tree stats on tablet */
            .tree-stats-modal {
                min-width: 450px;
                max-width: 500px;
            }
            .tree-stats-header-value {
                font-size: 28px;
            }
            /* Validation on tablet */
            .validation-modal {
                min-width: 450px;
                max-width: 550px;
            }
        }

        /* Mobile: show floating focus controls */
        @media (max-width: 600px) {
            .toolbar .toolbar-focus {
                display: none !important;
            }
            .focus-controls {
                display: flex !important;
                top: 54px;
                left: 8px;
                right: 8px;
                transform: none;
                padding: 8px 12px;
                flex-wrap: wrap;
                gap: 10px;
                z-index: 50;
            }
            .person-picker-dropdown {
                z-index: 500 !important;
            }
            .focus-info { font-size: 12px; white-space: nowrap; }
            .focus-info strong { display: inline; }
            .focus-depth { gap: 8px; font-size: 11px; }
            .focus-depth select { padding: 3px 6px; font-size: 11px; }
        }

        @media (max-width: 500px) {
            .toolbar {
                padding: 0 10px;
                gap: 6px;
            }
            .toolbar h1 { font-size: 16px; }
            .toolbar button {
                padding: 6px 10px;
                font-size: 12px;
            }

            /* Mobile modal: sticky footer buttons */
            .modal {
                min-width: 95vw;
                max-width: 95vw;
                max-height: 90vh;
                padding: 16px;
            }
            .modal-header {
                margin: -16px -16px 16px -16px;
                padding: 16px 16px 12px 16px;
                top: -16px;
            }
            .modal .form-row {
                flex-direction: column;
                gap: 0;
            }
            .modal .form-group.half {
                margin-bottom: 16px;
            }
            .modal .buttons {
                position: sticky;
                bottom: -16px;
                margin: 20px -16px -16px -16px;
                padding: 16px;
                background: var(--card-bg);
                border-top: 1px solid #eee;
            }
            [data-theme="dark"] .modal .buttons {
                border-top-color: #333;
            }

            /* Tree manager modal specific */
            .tree-manager-modal {
                padding: 0;
            }
            .tree-manager-modal .modal-header {
                margin: 0 0 12px 0;
                padding: 16px 16px 12px 16px;
            }
            .tree-manager-modal .tree-manager-list {
                max-height: 50vh;
                overflow-y: auto;
                padding: 0 16px;
            }
            .tree-manager-modal .tree-manager-footer {
                position: sticky;
                bottom: 0;
                padding: 12px 16px;
                background: var(--card-bg);
                border-top: 1px solid #eee;
            }
            [data-theme="dark"] .tree-manager-modal .tree-manager-footer {
                border-top-color: #333;
            }

            /* Tree stats on mobile */
            .tree-stats-modal {
                min-width: 100vw;
                max-width: 100vw;
                border-radius: 0;
                margin: 0;
            }
            .tree-stats-sections {
                grid-template-columns: 1fr;
            }
            .tree-stats-header {
                flex-direction: column;
                gap: 8px;
            }
            .tree-stats-header-value {
                font-size: 24px;
            }
            .tree-stats-header-label {
                font-size: 10px;
            }
            .tree-stats-grid {
                grid-template-columns: 1fr;
            }
            /* Validation on mobile */
            .validation-modal {
                min-width: 100vw;
                max-width: 100vw;
                border-radius: 0;
                margin: 0;
            }
            .validation-content {
                max-height: 50vh;
            }

            /* Merge modal on mobile */
            .merge-modal {
                max-width: 95vw;
                padding: 10px;
            }
            .merge-modal .modal-header {
                margin: -10px -10px 4px -10px;
                padding: 8px 10px;
            }
            .merge-modal .modal-header h2 {
                font-size: 14px;
            }
            .merge-wizard-explanation {
                font-size: 10px;
                margin-bottom: 4px;
                line-height: 1.2;
                color: var(--text-light);
            }
            .merge-progress {
                gap: 3px;
                margin-bottom: 4px;
            }
            .merge-progress .merge-step {
                font-size: 8px;
                padding: 2px 5px;
            }
            .merge-stats {
                gap: 4px;
                padding: 4px 6px;
                margin-bottom: 4px;
            }
            .merge-stat {
                gap: 1px;
            }
            .merge-stat-value {
                font-size: 13px;
            }
            .merge-stat-label {
                font-size: 8px;
            }
            .merge-tabs {
                gap: 2px;
                margin-bottom: 4px;
            }
            .merge-tab {
                padding: 3px 4px;
                font-size: 8px;
                border-radius: 4px;
            }
            .tab-count {
                font-size: 7px;
                padding: 0 2px;
                margin-left: 1px;
            }
            .merge-match-list {
                max-height: 50vh;
                margin-bottom: 0;
            }
            .merge-modal .buttons.merge-actions {
                margin-top: 8px;
                padding: 10px;
                margin-bottom: -10px;
                margin-left: -10px;
                margin-right: -10px;
            }
            .merge-item {
                padding: 8px 10px;
            }
            .merge-item-header {
                font-size: 12px;
            }
            .merge-item-actions {
                flex-wrap: wrap;
                gap: 4px;
                margin-top: 6px;
            }
            .merge-item-actions button {
                padding: 4px 8px;
                font-size: 10px;
            }
            .merge-actions {
                flex-wrap: wrap;
                gap: 6px;
                margin-top: 8px;
            }
            .merge-actions button {
                flex: 1 1 auto;
                min-width: 45%;
                font-size: 11px;
                padding: 8px 10px;
            }
            .merge-close-buttons {
                flex-direction: column;
                gap: 6px;
            }
            .merge-close-buttons button {
                width: 100%;
                padding: 10px;
            }
        }

        /* Landscape mobile: hide less important elements */
        @media (max-width: 700px) and (max-height: 450px) {
            .merge-wizard-explanation {
                display: none;
            }
            .merge-progress {
                display: none;
            }
            .merge-stats {
                padding: 3px 6px;
                margin-bottom: 3px;
            }
            .merge-stat-value {
                font-size: 12px;
            }
            .merge-stat-label {
                font-size: 7px;
            }
            .merge-tabs {
                margin-bottom: 3px;
            }
            .merge-modal {
                max-height: 95vh;
                padding: 8px;
            }
            .merge-modal .modal-header {
                margin: -8px -8px 4px -8px;
                padding: 6px 8px;
            }
            .merge-modal .modal-header h2 {
                font-size: 13px;
            }
            .merge-match-list {
                max-height: 30vh;
            }
            .merge-modal .buttons.merge-actions {
                padding: 6px 8px;
                margin: 4px -8px -8px -8px;
                gap: 4px;
            }
            .merge-actions button {
                padding: 6px 8px;
                font-size: 10px;
            }
        }

        /* ==================== DEBUG PANEL ==================== */
        .debug-panel {
            position: fixed;
            top: 60px;
            right: 10px;
            width: 280px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            z-index: 1000;
            font-size: 13px;
            display: none;
        }
        [data-theme="dark"] .debug-panel {
            border-color: #444;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        }
        .debug-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            border-bottom: 1px solid #eee;
            background: var(--bg);
            border-radius: 10px 10px 0 0;
        }
        [data-theme="dark"] .debug-panel-header {
            border-color: #333;
        }
        .debug-panel-title {
            font-weight: 600;
            color: var(--text);
        }
        .debug-panel-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0 4px;
        }
        .debug-panel-close:hover {
            color: var(--text);
        }
        .debug-panel-content {
            padding: 10px;
        }
        .debug-section {
            margin-bottom: 14px;
        }
        .debug-section:last-child {
            margin-bottom: 0;
        }
        .debug-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-light);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .debug-step-badge {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
            text-align: center;
        }
        .debug-badges-row {
            display: flex;
            gap: 8px;
        }
        .debug-count-badge {
            flex: 1;
            background: var(--bg);
            border-radius: 6px;
            padding: 8px 6px;
            text-align: center;
        }
        .debug-count-value {
            display: block;
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }
        .debug-count-label {
            display: block;
            font-size: 10px;
            color: var(--text-light);
            text-transform: uppercase;
        }
        .debug-validation-badge {
            flex: 1;
            background: #e8f5e9;
            border-radius: 6px;
            padding: 8px 6px;
            text-align: center;
        }
        .debug-validation-badge.error {
            background: #ffebee;
        }
        [data-theme="dark"] .debug-validation-badge {
            background: #1b3a1b;
        }
        [data-theme="dark"] .debug-validation-badge.error {
            background: #3a1b1b;
        }
        .debug-validation-status {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .debug-validation-status.pass {
            background: #4CAF50;
            color: white;
        }
        .debug-validation-status.fail {
            background: #f44336;
            color: white;
        }
        .debug-solver-stats {
            padding: 8px;
            background: var(--bg);
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        .debug-errors-list {
            background: var(--bg);
            border-radius: 6px;
            padding: 6px;
            max-height: 150px;
            overflow-y: auto;
        }
        .debug-error-row {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px 4px;
            font-family: monospace;
            font-size: 11px;
        }
        .debug-error-row:hover {
            background: rgba(0,0,0,0.05);
        }
        .debug-error-num {
            color: var(--text-light);
            width: 20px;
        }
        .debug-error-id {
            flex: 1;
            color: var(--text);
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .debug-error-value {
            color: #f44336;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <h1><span class="app-logo" onclick="window.Strom.UI.showAboutDialog()" title="About Strom">🌳</span> <span class="toolbar-title" data-i18n="toolbar.title"></span></h1>
        <div class="search-container">
            <div id="toolbar-search-picker"></div>
        </div>

        <!-- Toolbar Focus Info (tablet landscape) -->
        <div class="toolbar-focus tablet-only">
            <strong id="toolbar-focus-name" onclick="window.Strom.ZoomPan.centerOnFocusWithContext()" style="cursor:pointer;" title="Vycentrovat"></strong>
            <span id="toolbar-focus-count" class="focus-count" onclick="window.Strom.UI.showActiveTreeStats()" style="cursor:pointer;" title="Zobrazit statistiku"></span>
            <div class="focus-depth">
                <span>↑</span>
                <select id="toolbar-depth-up" onchange="window.Strom.TreeRenderer.setFocusDepth(parseInt(this.value), parseInt(document.getElementById('toolbar-depth-down').value))">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <span>↓</span>
                <select id="toolbar-depth-down" onchange="window.Strom.TreeRenderer.setFocusDepth(parseInt(document.getElementById('toolbar-depth-up').value), parseInt(this.value))">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
        </div>

        <!-- Tree Switcher (responsive - compact on mobile/tablet) -->
        <div class="tree-switcher">
            <button class="tree-switcher-btn" onclick="window.Strom.UI.toggleTreeSwitcher()">
                <span class="tree-icon">🌳</span>
                <span id="current-tree-name" class="tree-name">...</span>
                <span class="tree-dropdown-arrow">▾</span>
            </button>
            <div id="tree-switcher-dropdown" class="tree-switcher-dropdown">
                <!-- Tree list rendered dynamically -->
            </div>
        </div>

        <!-- Desktop buttons -->
        <div class="toolbar-buttons desktop-only">
            <button onclick="window.Strom.UI.showAddPersonModal()" data-i18n="toolbar.addPerson"></button>
        </div>

        <!-- Tablet add person (round +) -->
        <button class="add-person-round" onclick="window.Strom.UI.showAddPersonModal()" title="Add Person" data-i18n-title="toolbar.addPerson">+</button>

        <!-- Settings button (desktop) -->
        <button class="secondary desktop-only" onclick="window.Strom.UI.showSettingsDialog()" data-i18n-title="settings.title">⚙</button>

        <!-- Mobile hamburger -->
        <button class="hamburger-btn mobile-only" onclick="window.Strom.UI.toggleMobileMenu()">☰</button>
    </div>

    <!-- Mobile menu overlay -->
    <div id="mobile-menu" class="mobile-menu">
        <button class="edit-only" onclick="window.Strom.UI.showAddPersonModal(); window.Strom.UI.closeMobileMenu()" data-i18n="mobileMenu.addPerson"></button>
        <button class="edit-only" onclick="window.Strom.UI.showTreeManagerDialog(); window.Strom.UI.closeMobileMenu()">🌳 <span data-i18n="treeManager.manageTreesTitle"></span></button>
        <button onclick="window.Strom.UI.showSettingsDialog(); window.Strom.UI.closeMobileMenu()">⚙ <span data-i18n="settings.title"></span></button>
    </div>

    <div id="tree-container">
        <div id="tree-canvas">
            <svg id="tree-lines"></svg>
        </div>
        <div class="empty-state" id="empty-state">
            <h2 data-i18n="emptyState.title"></h2>
            <p data-i18n="emptyState.subtitle"></p>
            <button onclick="window.Strom.UI.showAddPersonModal()" data-i18n="emptyState.addFirst"></button>
            <button class="secondary" onclick="window.Strom.UI.showImportFileDialog()" data-i18n="emptyState.importFromFile"></button>
        </div>
    </div>

    <div class="zoom-controls">
        <button onclick="window.Strom.ZoomPan.zoomIn()" data-i18n-title="zoomControls.zoomIn">+</button>
        <button onclick="window.Strom.ZoomPan.zoomOut()" data-i18n-title="zoomControls.zoomOut">−</button>
        <button onclick="window.Strom.ZoomPan.reset()" data-i18n-title="zoomControls.reset">⟲</button>
        <button onclick="window.Strom.ZoomPan.fitToScreen()" data-i18n-title="zoomControls.fitToScreen">⛶</button>
    </div>

    <!-- Focus Mode Controls -->
    <div id="focus-controls" class="focus-controls">
        <div class="focus-info">
            <strong id="focus-name" onclick="window.Strom.ZoomPan.centerOnFocusWithContext()" style="cursor:pointer;" title="Vycentrovat"></strong>
            <span id="focus-person-count" class="focus-count" onclick="window.Strom.UI.showActiveTreeStats()" style="cursor:pointer;" title="Zobrazit statistiku"></span>
        </div>
        <div class="focus-depth">
            <label>
                <span>↑</span>
                <select id="focus-depth-up" onchange="window.Strom.TreeRenderer.setFocusDepth(parseInt(this.value), parseInt(document.getElementById('focus-depth-down').value))">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </label>
            <label>
                <span>↓</span>
                <select id="focus-depth-down" onchange="window.Strom.TreeRenderer.setFocusDepth(parseInt(document.getElementById('focus-depth-up').value), parseInt(this.value))">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </label>
        </div>
    </div>

    <!-- Person Modal -->
    <div class="modal-overlay" id="person-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title" data-i18n="personModal.addTitle"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeModal()">&times;</button>
            </div>
            <div class="form-group">
                <label data-i18n="labels.firstName"></label>
                <input type="text" id="input-firstname" data-i18n-placeholder="placeholders.firstName">
            </div>
            <div class="form-group">
                <label id="lastname-label" data-i18n="labels.lastName"></label>
                <input type="text" id="input-lastname" data-i18n-placeholder="placeholders.lastName">
            </div>
            <div class="form-group">
                <label data-i18n="labels.gender"></label>
                <select id="input-gender">
                    <option value="male" data-i18n="gender.male"></option>
                    <option value="female" data-i18n="gender.female"></option>
                </select>
            </div>
            <div class="form-group">
                <label data-i18n="labels.birthDate"></label>
                <input type="date" id="input-birthdate">
            </div>
            <div class="form-group">
                <label data-i18n="labels.birthPlace"></label>
                <input type="text" id="input-birthplace">
            </div>
            <button type="button" class="expand-btn" id="expand-details">
                <span class="expand-icon">▶</span> <span data-i18n="labels.moreInfo">More Info</span>
            </button>
            <div id="extended-fields" class="extended-fields">
                <div class="form-row">
                    <div class="form-group half">
                        <label data-i18n="labels.deathDate"></label>
                        <input type="date" id="input-deathdate">
                    </div>
                    <div class="form-group half">
                        <label data-i18n="labels.deathPlace"></label>
                        <input type="text" id="input-deathplace">
                    </div>
                </div>
            </div>
            <button type="button" class="link-relationships-btn" id="link-relationships" style="display:none;">
                &#128279; <span data-i18n="buttons.manageRelationships">Manage Relationships</span>
            </button>
            <div class="buttons">
                <button class="danger" id="btn-delete" style="display:none;" onclick="window.Strom.UI.deletePerson()" data-i18n="buttons.delete"></button>
                <button class="secondary" id="btn-merge" style="display:none;" onclick="window.Strom.UI.mergePersonFromModal()">&#128279; <span data-i18n="personMerge.mergeWith"></span>...</button>
                <button class="secondary" onclick="window.Strom.UI.closeModal()" data-i18n="buttons.cancel"></button>
                <button class="primary" onclick="window.Strom.UI.savePerson()" data-i18n="buttons.save"></button>
            </div>
        </div>
    </div>

    <!-- Relation Modal -->
    <div class="modal-overlay" id="relation-modal">
        <div class="modal">
            <h2 id="relation-title"></h2>
            <div id="rel-other-parent" class="form-group" style="display:none;">
                <label id="rel-other-parent-label"></label>
                <select id="rel-other-parent-select"></select>
            </div>
            <div id="new-person-fields">
                <div class="form-group">
                    <label data-i18n="labels.firstName"></label>
                    <input type="text" id="rel-firstname" data-i18n-placeholder="placeholders.firstName">
                </div>
                <div class="form-group">
                    <label data-i18n="labels.lastName"></label>
                    <input type="text" id="rel-lastname" data-i18n-placeholder="placeholders.lastName">
                </div>
                <div class="form-group">
                    <label data-i18n="labels.gender"></label>
                    <select id="rel-gender">
                        <option value="male" data-i18n="gender.male"></option>
                        <option value="female" data-i18n="gender.female"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="labels.birthDate"></label>
                    <input type="date" id="rel-birthdate">
                </div>
                <div class="form-group">
                    <label data-i18n="labels.birthPlace"></label>
                    <input type="text" id="rel-birthplace">
                </div>
                <button type="button" id="rel-expand-btn" class="expand-btn">
                    <span class="expand-icon">▶</span> <span data-i18n="labels.moreInfo"></span>
                </button>
                <div id="rel-extended-fields" class="extended-fields">
                    <div class="form-row">
                        <div class="form-group half">
                            <label data-i18n="labels.deathDate"></label>
                            <input type="date" id="rel-deathdate">
                        </div>
                        <div class="form-group half">
                            <label data-i18n="labels.deathPlace"></label>
                            <input type="text" id="rel-deathplace">
                        </div>
                    </div>
                </div>
            </div>
            <div id="existing-person-field" style="display:none;">
                <div class="form-group">
                    <label data-i18n="labels.selectPerson"></label>
                    <div id="existing-person-picker"></div>
                </div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeRelationModal()" data-i18n="buttons.cancel"></button>
                <button class="secondary" id="toggle-link-mode" data-i18n-title="relationModal.linkExistingTitle">&#128279; <span data-i18n="relationModal.linkExisting"></span></button>
                <button class="secondary merge-btn-preview-wide" id="rel-preview-btn" onclick="window.Strom.UI.previewRelationPerson()" style="display:none;">👁</button>
                <button class="primary" id="rel-submit-btn" onclick="window.Strom.UI.saveRelation()" data-i18n="buttons.add"></button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal">
            <h2 id="confirm-title"></h2>
            <div class="confirm-message" id="confirm-message"></div>
            <div class="confirm-options" id="confirm-options"></div>
            <div class="buttons" id="confirm-buttons">
                <button class="secondary" id="confirm-cancel-btn" data-i18n="buttons.cancel"></button>
                <button class="primary" id="confirm-ok-btn" data-i18n="buttons.ok"></button>
            </div>
        </div>
    </div>

    <!-- Relationships Panel Modal -->
    <div class="modal-overlay" id="relationships-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="relationships-title"></h2>
                <button class="close-btn" onclick="window.Strom.UI.cancelRelationshipsPanel()">&times;</button>
            </div>
            <div id="relationships-content"></div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.cancelRelationshipsPanel()" data-i18n="buttons.cancel"></button>
                <button class="primary" onclick="window.Strom.UI.saveRelationships()" data-i18n="buttons.save"></button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal-overlay" id="about-modal">
        <div class="modal about-modal">
            <button class="close-btn" onclick="window.Strom.UI.closeAboutDialog()">&times;</button>
            <div class="about-header">
                <span class="about-logo">🌳</span>
                <span class="about-title">Strom <span id="about-version">1.0</span></span>
            </div>
            <p class="about-description" data-i18n="about.description"></p>
            <p class="about-author"><span data-i18n="about.createdBy"></span> <strong data-i18n="about.authorName"></strong></p>
            <div class="about-meta">
                <a href="https://stromapp.info" target="_blank" rel="noopener">stromapp.info</a>
                <span>•</span>
                <span>MPL-2.0</span>
            </div>
            <div class="about-stats" id="about-stats">
                <div class="about-tree-name" id="stat-tree-name">-</div>
                <div class="about-stats-row" id="about-stats-row"></div>
            </div>
            <div class="about-stats about-stats-total" id="about-stats-total">
                <div class="about-stats-row" id="about-stats-total-row"></div>
            </div>
        </div>
    </div>

    <!-- Settings Dialog -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h2 data-i18n="settings.title"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeSettingsDialog()">&times;</button>
            </div>
            <div class="settings-section encryption-section">
                <label class="settings-label" data-i18n="encryption.enable"></label>
                <div class="settings-options">
                    <label class="settings-checkbox">
                        <input type="checkbox" id="encryption-toggle" onchange="window.Strom.UI.toggleEncryption(this.checked)">
                        <span id="encryption-status"></span>
                    </label>
                </div>
                <p class="settings-hint" data-i18n="encryption.warning"></p>
            </div>
            <div class="settings-section">
                <label class="settings-label" data-i18n="auditLog.enableSetting"></label>
                <div class="settings-options">
                    <label class="settings-checkbox">
                        <input type="checkbox" id="audit-log-toggle" onchange="window.Strom.UI.toggleAuditLog(this.checked)">
                        <span id="audit-log-status"></span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <label class="settings-label" data-i18n="settings.language"></label>
                <div class="settings-options">
                    <label class="settings-radio">
                        <input type="radio" name="language" value="system" onchange="window.Strom.UI.setLanguage('system')">
                        <span data-i18n="settings.languageSystem"></span>
                    </label>
                    <label class="settings-radio">
                        <input type="radio" name="language" value="en" onchange="window.Strom.UI.setLanguage('en')">
                        <span>English</span>
                    </label>
                    <label class="settings-radio">
                        <input type="radio" name="language" value="cs" onchange="window.Strom.UI.setLanguage('cs')">
                        <span>Čeština</span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <label class="settings-label" data-i18n="settings.theme"></label>
                <div class="settings-options">
                    <label class="settings-radio">
                        <input type="radio" name="theme" value="system" onchange="window.Strom.UI.setTheme('system')">
                        <span data-i18n="settings.themeSystem"></span>
                    </label>
                    <label class="settings-radio">
                        <input type="radio" name="theme" value="light" onchange="window.Strom.UI.setTheme('light')">
                        <span data-i18n="settings.themeLight"></span>
                    </label>
                    <label class="settings-radio">
                        <input type="radio" name="theme" value="dark" onchange="window.Strom.UI.setTheme('dark')">
                        <span data-i18n="settings.themeDark"></span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="secondary" onclick="window.Strom.UI.closeSettingsDialog()" data-i18n="settings.close"></button>
            </div>
        </div>
    </div>

    <!-- Audit Log Dialog -->
    <div class="modal-overlay" id="audit-log-modal">
        <div class="modal audit-log-modal">
            <div class="modal-header">
                <h2 class="audit-log-title-text" data-i18n="auditLog.title"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeAuditLogDialog()">&times;</button>
            </div>
            <div class="audit-log-meta">
                <span id="audit-log-count"></span>
            </div>
            <div class="audit-log-list" id="audit-log-list"></div>
            <div class="modal-actions">
                <button class="secondary" onclick="window.Strom.UI.exportAuditLogTxt()" data-i18n="auditLog.exportTxt"></button>
                <button class="danger" onclick="window.Strom.UI.clearAuditLog()" data-i18n="auditLog.clear"></button>
                <button class="secondary" onclick="window.Strom.UI.closeAuditLogDialog()" data-i18n="buttons.close"></button>
            </div>
        </div>
    </div>

    <!-- Export Dialog -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="menu.export"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeExportDialog()">&times;</button>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.UI.exportTargetTreeJSON()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportJson"></span>
                        <span class="option-desc" data-i18n="menu.exportJsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" id="export-focus-btn" onclick="window.Strom.UI.exportFocusedJSON()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportFocus"></span>
                        <span class="option-desc" data-i18n="menu.exportFocusDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.exportTargetTreeApp()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportApp"></span>
                        <span class="option-desc" data-i18n="menu.exportAppDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.exportTargetTreeGedcom()">
                    <span class="option-icon">🌳</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportGedcom"></span>
                        <span class="option-desc" data-i18n="menu.exportGedcomDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Import Dialog -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="menu.import"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeImportDialog()">&times;</button>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="document.getElementById('file-input').click(); window.Strom.UI.closeImportDialog()">
                    <span class="option-icon">📄</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.importJson"></span>
                        <span class="option-desc" data-i18n="menu.importJsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="document.getElementById('gedcom-input').click(); window.Strom.UI.closeImportDialog()">
                    <span class="option-icon">🌳</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.importGedcom"></span>
                        <span class="option-desc" data-i18n="menu.importGedcomDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" accept=".json" onchange="window.Strom.UI.handleJsonFile(event)">
    <input type="file" id="gedcom-input" accept=".ged" onchange="window.Strom.UI.handleGedcomFile(event)">
    <input type="file" id="html-input" accept=".html,.htm" onchange="window.Strom.UI.handleHtmlFile(event)">

    <!-- GEDCOM Result Dialog -->
    <div class="modal-overlay" id="gedcom-result-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="gedcom.resultTitle"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeGedcomResultDialog()">&times;</button>
            </div>
            <div class="gedcom-stats">
                <div class="stat-item">
                    <div class="number" id="gedcom-stat-persons">0</div>
                    <div class="label" data-i18n="gedcom.persons"></div>
                </div>
                <div class="stat-item">
                    <div class="number" id="gedcom-stat-partnerships">0</div>
                    <div class="label" data-i18n="gedcom.partnerships"></div>
                </div>
                <div class="stat-item">
                    <div class="number skipped" id="gedcom-stat-skipped">0</div>
                    <div class="label" data-i18n="gedcom.skipped"></div>
                </div>
            </div>
            <div class="menu-options" id="gedcom-options">
                <!-- Normal options (hidden when importing to current tree) -->
                <button id="gedcom-new-tree-btn" class="menu-option" onclick="window.Strom.UI.importGedcomAsNewTree()">
                    <span class="option-icon">🌳</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="gedcom.importAsNew"></span>
                        <span class="option-desc" data-i18n="gedcom.importAsNewDesc"></span>
                    </span>
                </button>
                <button id="gedcom-merge-btn" class="menu-option" onclick="window.Strom.UI.mergeGedcomWithExisting()">
                    <span class="option-icon">🔀</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="gedcom.mergeExisting"></span>
                        <span class="option-desc" data-i18n="gedcom.mergeExistingDesc"></span>
                    </span>
                </button>
                <button id="gedcom-save-json-btn" class="menu-option" onclick="window.Strom.UI.downloadGedcomAsJson()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="gedcom.saveAsJson"></span>
                        <span class="option-desc" data-i18n="gedcom.saveAsJsonDesc"></span>
                    </span>
                </button>
                <!-- Insert to current tree option (shown only when importing to current tree) -->
                <button id="gedcom-insert-btn" class="menu-option" style="display: none;" onclick="window.Strom.UI.importGedcomAsNewTree()">
                    <span class="option-icon">📥</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="gedcom.insertToTree"></span>
                        <span class="option-desc" data-i18n="gedcom.insertToTreeDesc"></span>
                    </span>
                </button>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeGedcomResultDialog()" data-i18n="buttons.cancel"></button>
            </div>
        </div>
    </div>

    <!-- Save Current Data Dialog -->
    <div class="modal-overlay" id="save-current-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="saveCurrent.title"></h2>
                <button class="close-btn" onclick="window.Strom.UI.closeSaveCurrentDialog()">&times;</button>
            </div>
            <p class="save-current-message" data-i18n="saveCurrent.message"></p>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.DataManager.exportJSON(); window.Strom.UI.closeSaveCurrentDialog()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="saveCurrent.exportJson"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.exportCurrentTreeApp()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="saveCurrent.exportApp"></span>
                    </span>
                </button>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeSaveCurrentDialog()" data-i18n="buttons.cancel"></button>
                <button class="primary" id="save-current-continue-btn" data-i18n="saveCurrent.continueWithout"></button>
            </div>
        </div>
    </div>

    <!-- Merge Import Modal -->
    <div class="modal-overlay" id="merge-modal">
        <div class="modal merge-modal">
            <div class="modal-header">
                <h2 data-i18n="merge.wizardTitle">Merge Data</h2>
                <button class="close-btn" onclick="window.Strom.MergerUI.closeMergeModal()">&times;</button>
            </div>
            <p id="merge-wizard-explanation" class="merge-wizard-explanation" data-i18n="merge.wizardExplanation"></p>
            <div class="merge-progress">
                <span id="merge-step-review" class="merge-step active" data-i18n="merge.stepReview">1. Review matches</span>
                <span id="merge-step-resolve" class="merge-step" data-i18n="merge.stepResolve">2. Resolve conflicts</span>
                <span id="merge-step-execute" class="merge-step" data-i18n="merge.stepExecute">3. Execute merge</span>
            </div>
            <div class="merge-stats">
                <div class="merge-stat">
                    <span class="merge-stat-label" data-i18n="merge.importCount">Import</span>
                    <span class="merge-stat-value" id="merge-stat-import">0</span>
                </div>
                <div class="merge-stat">
                    <span class="merge-stat-label" data-i18n="merge.existingCount">Existing</span>
                    <span class="merge-stat-value" id="merge-stat-existing">0</span>
                </div>
                <div class="merge-stat highlight">
                    <span class="merge-stat-label">✓</span>
                    <span class="merge-stat-value" id="merge-stat-matches">0</span>
                </div>
                <div class="merge-stat warning">
                    <span class="merge-stat-label">⚠</span>
                    <span class="merge-stat-value" id="merge-stat-conflicts">0</span>
                </div>
                <div class="merge-stat new">
                    <span class="merge-stat-label">+</span>
                    <span class="merge-stat-value" id="merge-stat-new">0</span>
                </div>
            </div>
            <div class="merge-tabs">
                <button class="merge-tab active" data-filter="all" onclick="window.Strom.MergerUI.setFilter('all')" data-i18n="merge.tabAll">All</button>
                <button class="merge-tab" data-filter="high" onclick="window.Strom.MergerUI.setFilter('high')">
                    <span data-i18n="merge.highConfidence">High</span> <span class="tab-count" id="tab-count-high">0</span>
                </button>
                <button class="merge-tab" data-filter="medium" onclick="window.Strom.MergerUI.setFilter('medium')">
                    <span data-i18n="merge.mediumConfidence">Medium</span> <span class="tab-count" id="tab-count-medium">0</span>
                </button>
                <button class="merge-tab" data-filter="low" onclick="window.Strom.MergerUI.setFilter('low')">
                    <span data-i18n="merge.lowConfidence">Low</span> <span class="tab-count" id="tab-count-low">0</span>
                </button>
                <button class="merge-tab" data-filter="unmatched" onclick="window.Strom.MergerUI.setFilter('unmatched')">
                    <span data-i18n="merge.statsNew">New</span> <span class="tab-count" id="tab-count-unmatched">0</span>
                </button>
                <button class="merge-tab" data-filter="conflicts" onclick="window.Strom.MergerUI.setFilter('conflicts')">
                    <span data-i18n="merge.conflicts">Conflicts</span> <span class="tab-count" id="tab-count-conflicts">0</span>
                </button>
            </div>
            <div class="merge-match-list" id="merge-match-list">
                <!-- Match items rendered here -->
            </div>
            <div class="buttons merge-actions">
                <button class="secondary" onclick="window.Strom.MergerUI.closeMergeModal()" data-i18n="buttons.cancel">Cancel</button>
                <button class="secondary" onclick="window.Strom.MergerUI.saveForLater()" data-i18n="merge.closeSave">Save for later</button>
                <button class="secondary" onclick="window.Strom.MergerUI.reanalyze()" data-i18n="merge.reanalyze">Re-analyze</button>
                <button class="primary" onclick="window.Strom.MergerUI.executeMerge()" data-i18n="merge.execute">Execute Merge</button>
            </div>
        </div>
    </div>

    <!-- Manual Match Dialog -->
    <div class="modal-overlay" id="merge-manual-dialog">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="merge.manualMatch">Match to existing</h2>
                <button class="close-btn" onclick="window.Strom.MergerUI.closeManualMatchDialog()">&times;</button>
            </div>
            <div class="form-group">
                <label data-i18n="merge.incomingPerson">Incoming person:</label>
                <div id="merge-manual-incoming" class="merge-manual-person"></div>
            </div>
            <div class="form-group">
                <label data-i18n="labels.selectPerson">Select Person</label>
                <div id="merge-manual-picker"></div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.MergerUI.closeManualMatchDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button id="merge-manual-preview-btn" class="secondary merge-btn-preview-wide" onclick="window.Strom.MergerUI.previewManualMatch()" title="Preview">👁</button>
                <button class="primary" onclick="window.Strom.MergerUI.confirmManualMatch()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Conflict Resolution Dialog -->
    <div class="modal-overlay" id="merge-conflict-dialog">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="merge.conflicts">Conflicts</h2>
                <button class="close-btn" onclick="window.Strom.MergerUI.closeConflictDialog()">&times;</button>
            </div>
            <div id="merge-conflict-content" class="merge-conflict-content">
                <!-- Conflict rows rendered here -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.MergerUI.closeConflictDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.MergerUI.saveConflictResolutions()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Merge Close Confirmation Dialog -->
    <div class="modal-overlay" id="merge-close-confirm">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="merge.closeConfirmTitle">Close Merge?</h2>
            </div>
            <p class="merge-close-message" data-i18n="merge.closeConfirmMessage">You have unsaved merge progress.</p>
            <div class="buttons merge-close-buttons">
                <button class="secondary" onclick="window.Strom.MergerUI.handleCloseDiscard()" data-i18n="merge.closeDiscard">Discard changes</button>
                <button class="primary" onclick="window.Strom.MergerUI.handleCloseSave()" data-i18n="merge.closeSave">Save for later</button>
                <button class="secondary" onclick="window.Strom.MergerUI.handleCloseCancel()" data-i18n="merge.closeCancel">Continue merging</button>
            </div>
        </div>
    </div>

    <!-- Pending Merge Dialog -->
    <div class="modal-overlay" id="pending-merge-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="merge.pendingMerges">Pending Merges</h2>
                <button class="close-btn" onclick="window.Strom.UI.closePendingMergeDialog()">&times;</button>
            </div>
            <p class="pending-merge-message" data-i18n="merge.pendingMergeFound">You have a pending merge session</p>
            <div id="pending-merge-list" class="pending-merge-list">
                <!-- Pending merge items rendered here -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closePendingMergeDialog()" data-i18n="buttons.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Person Merge Dialog -->
    <div class="modal-overlay" id="person-merge-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="personMerge.title">Merge Persons</h2>
                <button class="close-btn" onclick="window.Strom.UI.closePersonMergeDialog()">&times;</button>
            </div>
            <div class="person-merge-content">
                <div class="form-group">
                    <label data-i18n="personMerge.keepPerson">Keep</label>
                    <div id="person-merge-keep" class="person-merge-person"></div>
                </div>
                <div class="form-group">
                    <label data-i18n="personMerge.mergeWith">Merge with</label>
                    <div id="person-merge-picker"></div>
                </div>
                <div id="person-merge-preview" class="person-merge-preview" style="display: none;">
                    <div id="person-merge-other" class="person-merge-person other"></div>
                    <p class="person-merge-warning">
                        <span class="warning-icon">⚠️</span>
                        <span id="person-merge-delete-info"></span>
                    </p>
                </div>
                <div id="person-merge-conflicts" class="person-merge-conflicts" style="display: none;">
                    <h3 data-i18n="personMerge.fieldConflicts">Field conflicts</h3>
                    <div id="person-merge-field-conflicts"></div>
                </div>
                <div id="person-merge-partnership-conflicts" class="person-merge-conflicts" style="display: none;">
                    <h3 data-i18n="personMerge.partnershipConflicts">Partnership conflicts</h3>
                    <div id="person-merge-partnership-list"></div>
                </div>
                <div id="person-merge-no-conflicts" class="person-merge-no-conflicts" style="display: none;">
                    <span class="success-icon">✓</span>
                    <span data-i18n="personMerge.noConflicts">No conflicts - data will be combined</span>
                </div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closePersonMergeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="secondary merge-btn-preview-wide" onclick="window.Strom.UI.previewPersonMerge()" title="Preview">👁</button>
                <button class="primary" id="person-merge-btn" onclick="window.Strom.UI.executePersonMerge()" data-i18n="personMerge.confirmMerge" disabled>Merge persons</button>
            </div>
        </div>
    </div>

    <!-- Validation Error Dialog -->
    <div class="modal-overlay" id="validation-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="validation.validationFailed">Validation</h2>
                <button class="close-btn" onclick="document.getElementById('validation-modal').classList.remove('active')">&times;</button>
            </div>
            <div id="validation-content" class="validation-content">
                <!-- Validation errors/warnings rendered here -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="document.getElementById('validation-modal').classList.remove('active')" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" id="validation-continue-btn" style="display:none" data-i18n="validation.continueWithWarnings">Continue</button>
            </div>
        </div>
    </div>

    <!-- Tree Manager Dialog -->
    <div class="modal-overlay" id="tree-manager-modal">
        <div class="modal tree-manager-modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.manageTreesTitle">Manage Trees</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeTreeManagerDialog()">&times;</button>
            </div>
            <div id="tree-manager-list" class="tree-manager-list">
                <!-- Tree list rendered dynamically -->
            </div>
            <div class="tree-manager-footer">
                <button class="primary edit-only" onclick="window.Strom.UI.showNewTreeMenu()">
                    <span class="btn-icon">🌱</span><span class="btn-text" data-i18n="treeManager.newTree">New Tree</span>
                </button>
                <button class="secondary edit-only" onclick="window.Strom.UI.showDefaultTreeDialog()" title="Default Tree">
                    <span class="btn-icon">⭐</span><span class="btn-text" data-i18n="treeManager.defaultTree">Default Tree</span>
                </button>
                <button class="secondary" onclick="window.Strom.UI.showExportAllDialog()" title="Export All">
                    <span class="btn-icon">💾</span><span class="btn-text" data-i18n="treeManager.exportAll">Export All</span>
                </button>
            </div>
        </div>
    </div>

    <!-- New Tree Dialog -->
    <div class="modal-overlay" id="new-tree-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.newTree">New Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeNewTreeDialog()">&times;</button>
            </div>
            <div class="form-group">
                <label data-i18n="treeManager.treeNameLabel">Tree name</label>
                <input type="text" id="new-tree-name" data-i18n-placeholder="treeManager.newTreePlaceholder">
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeNewTreeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.createNewTreeFromDialog()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Rename Tree Dialog -->
    <div class="modal-overlay" id="rename-tree-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.rename">Rename</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeRenameTreeDialog()">&times;</button>
            </div>
            <div class="form-group">
                <label data-i18n="treeManager.treeNameLabel">Tree name</label>
                <input type="text" id="rename-tree-name">
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeRenameTreeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.confirmRenameTree()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Duplicate Tree Dialog -->
    <div class="modal-overlay" id="duplicate-tree-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.duplicateTitle">Duplicate Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeDuplicateTreeDialog()">&times;</button>
            </div>
            <div class="form-group">
                <label data-i18n="treeManager.newTreeNameLabel">New tree name</label>
                <input type="text" id="duplicate-tree-name">
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeDuplicateTreeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.confirmDuplicateTree()" data-i18n="treeManager.duplicate">Duplicate</button>
            </div>
        </div>
    </div>

    <!-- Tree Stats Dialog -->
    <div class="modal-overlay" id="tree-stats-modal">
        <div class="modal tree-stats-modal">
            <div class="modal-header">
                <h2 id="tree-stats-title" data-i18n="treeManager.statsTitle">Tree Statistics</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeTreeStatsDialog()">&times;</button>
            </div>
            <div id="tree-stats-content" class="tree-stats-content">
                <!-- Stats rendered dynamically -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeTreeStatsDialog()" data-i18n="buttons.close">Close</button>
            </div>
        </div>
    </div>

    <!-- Tree Validation Dialog (genealogical consistency checks) -->
    <div class="modal-overlay" id="tree-validation-modal">
        <div class="modal validation-modal">
            <div class="modal-header">
                <h2 id="tree-validation-title" data-i18n="treeManager.validationTitle">Tree Validation</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeTreeValidationDialog()">&times;</button>
            </div>
            <div id="tree-validation-content" class="validation-content">
                <!-- Validation results rendered dynamically -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeTreeValidationDialog()" data-i18n="buttons.close">Close</button>
            </div>
        </div>
    </div>

    <!-- Default Person Dialog -->
    <div class="modal-overlay" id="default-person-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.defaultPerson">Default Person</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeDefaultPersonDialog()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="treeManager.defaultPersonDesc">When opening this tree, focus on:</p>
            <div class="default-options">
                <label class="radio-option">
                    <input type="radio" name="default-person-option" id="default-person-first" value="first">
                    <span id="default-person-first-label">First person</span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="default-person-option" id="default-person-last" value="last">
                    <span data-i18n="treeManager.defaultPersonLastFocused">Last focused</span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="default-person-option" id="default-person-specific" value="specific">
                    <span data-i18n="treeManager.defaultPersonSpecific">Specific person:</span>
                </label>
                <div id="default-person-picker-container" class="picker-container" style="display: none;">
                    <div id="default-person-picker"></div>
                </div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeDefaultPersonDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.confirmDefaultPerson()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Default Tree Dialog -->
    <div class="modal-overlay" id="default-tree-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.defaultTree">Default Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeDefaultTreeDialog()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="treeManager.defaultTreeDesc">When opening app, load:</p>
            <div class="default-options">
                <label class="radio-option">
                    <input type="radio" name="default-tree-option" id="default-tree-first" value="first">
                    <span id="default-tree-first-label">First tree</span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="default-tree-option" id="default-tree-last" value="last">
                    <span data-i18n="treeManager.defaultTreeLastFocused">Last focused</span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="default-tree-option" id="default-tree-specific" value="specific">
                    <span data-i18n="treeManager.defaultTreeSpecific">Specific tree:</span>
                </label>
                <div id="default-tree-select-container" class="picker-container" style="display: none;">
                    <select id="default-tree-select" class="tree-select"></select>
                </div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeDefaultTreeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.confirmDefaultTree()" data-i18n="buttons.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Merge Trees Dialog -->
    <div class="modal-overlay" id="merge-trees-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.mergeInto">Merge into...</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeMergeTreesDialog()">&times;</button>
            </div>
            <p id="merge-trees-description" class="merge-trees-description"></p>
            <div id="merge-trees-options" class="merge-trees-options">
                <!-- Target tree options rendered here -->
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeMergeTreesDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" id="merge-trees-btn" onclick="window.Strom.UI.startTreeMerge()" data-i18n="treeManager.startMerge">Start Merge</button>
            </div>
        </div>
    </div>

    <!-- Import Tree Dialog -->
    <div class="modal-overlay" id="import-tree-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.importAsNewTree">Import as New Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeImportTreeDialog()">&times;</button>
            </div>
            <div class="import-tree-stats">
                <div class="stat-item">
                    <div class="number" id="import-tree-persons">0</div>
                    <div class="label" data-i18n="gedcom.persons">Persons</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="import-tree-partnerships">0</div>
                    <div class="label" data-i18n="gedcom.partnerships">Partnerships</div>
                </div>
            </div>
            <div class="form-group">
                <label data-i18n="treeManager.treeNameLabel">Tree name</label>
                <input type="text" id="import-tree-name" data-i18n-placeholder="treeManager.newTreePlaceholder">
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeImportTreeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.confirmImportTree()" data-i18n="menu.import">Import</button>
            </div>
        </div>
    </div>

    <!-- New Tree Menu Dialog -->
    <div class="modal-overlay" id="new-tree-menu-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 id="new-tree-menu-title" data-i18n="treeManager.newTreeMenu">New Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeNewTreeMenu()">&times;</button>
            </div>
            <div id="new-tree-menu-intro" class="menu-intro" style="display: none;">
                <p data-i18n="importFromOffline.description">Welcome to stromapp.info! To continue with your data, import the file you were using.</p>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.UI.showNewTreeDialog()">
                    <span class="option-icon">📄</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.emptyTree"></span>
                        <span class="option-desc" data-i18n="treeManager.emptyTreeDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.startJsonImportFromManager()">
                    <span class="option-icon">📥</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromJson"></span>
                        <span class="option-desc" data-i18n="treeManager.fromJsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.startGedcomImportFromManager()">
                    <span class="option-icon">🌳</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromGedcom"></span>
                        <span class="option-desc" data-i18n="treeManager.fromGedcomDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.startHtmlImportFromManager()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromHtml"></span>
                        <span class="option-desc" data-i18n="treeManager.fromHtmlDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.createTreeFromFocus()">
                    <span class="option-icon">🎯</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromFocus"></span>
                        <span class="option-desc" data-i18n="treeManager.fromFocusDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Import File Dialog (for empty state) -->
    <div class="modal-overlay" id="import-file-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="emptyState.importFromFile">Import from File</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeImportFileDialog()">&times;</button>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.UI.importJsonToCurrentTree()">
                    <span class="option-icon">📥</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromJson"></span>
                        <span class="option-desc" data-i18n="treeManager.fromJsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.importGedcomToCurrentTree()">
                    <span class="option-icon">🌳</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromGedcom"></span>
                        <span class="option-desc" data-i18n="treeManager.fromGedcomDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.importHtmlToCurrentTree()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.fromHtml"></span>
                        <span class="option-desc" data-i18n="treeManager.fromHtmlDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Export All Dialog -->
    <div class="modal-overlay" id="export-all-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="treeManager.exportAll">Export All Trees</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeExportAllDialog()">&times;</button>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.UI.exportAllAsJson()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.exportAllJson"></span>
                        <span class="option-desc" data-i18n="treeManager.exportAllJsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.exportAllTreesApp()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="treeManager.exportAllApp"></span>
                        <span class="option-desc" data-i18n="treeManager.exportAllAppDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Export Focus Dialog -->
    <div class="modal-overlay" id="export-focus-modal">
        <div class="modal menu-modal">
            <div class="modal-header">
                <h2 data-i18n="menu.exportFocus">Export Focus</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeExportFocusDialog()">&times;</button>
            </div>
            <div class="menu-options">
                <button class="menu-option" onclick="window.Strom.UI.exportFocusedJSONFromDialog()">
                    <span class="option-icon">💾</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportJson"></span>
                        <span class="option-desc" data-i18n="exportFocus.jsonDesc"></span>
                    </span>
                </button>
                <button class="menu-option" onclick="window.Strom.UI.exportFocusAsApp()">
                    <span class="option-icon">📦</span>
                    <span class="option-text">
                        <span class="option-title" data-i18n="menu.exportApp"></span>
                        <span class="option-desc" data-i18n="exportFocus.appDesc"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Password Prompt Dialog (unlock encrypted data) -->
    <div class="modal-overlay" id="password-prompt-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="encryption.unlockData">Unlock Data</h2>
                <button class="close-btn" onclick="window.Strom.UI.cancelPasswordPrompt()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="encryption.enterPasswordToView">Enter password to view</p>
            <form id="password-prompt-form" onsubmit="event.preventDefault(); window.Strom.UI.submitPasswordPrompt();">
                <!-- Hidden username for password manager compatibility -->
                <input type="text" name="username" autocomplete="username" value="strom-user" style="display:none;">
                <div class="form-group">
                    <label data-i18n="encryption.enterPassword">Enter Password</label>
                    <input type="password" id="password-prompt-input" name="password" autocomplete="current-password">
                </div>
                <div id="password-prompt-error" class="form-error" style="display: none;"></div>
                <div class="buttons">
                    <button type="button" class="secondary" onclick="window.Strom.UI.cancelPasswordPrompt()" data-i18n="buttons.cancel">Cancel</button>
                    <button type="submit" class="primary" data-i18n="buttons.ok">OK</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Password Setup Dialog (enable encryption) -->
    <div class="modal-overlay" id="password-setup-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="encryption.setPassword">Set Password</h2>
                <button class="close-btn" onclick="window.Strom.UI.closePasswordSetupDialog()">&times;</button>
            </div>
            <div class="form-warning">
                <span class="warning-icon">⚠️</span>
                <span data-i18n="encryption.warning">If you forget the password, your data cannot be recovered.</span>
            </div>
            <form id="password-setup-form" onsubmit="event.preventDefault(); window.Strom.UI.confirmPasswordSetup();">
                <!-- Hidden username for password manager compatibility -->
                <input type="text" name="username" autocomplete="username" value="strom-user" style="display:none;">
                <div class="form-group">
                    <label data-i18n="encryption.setPassword">Set Password</label>
                    <input type="password" id="password-setup-input" name="password" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label data-i18n="encryption.confirmPassword">Confirm Password</label>
                    <input type="password" id="password-setup-confirm" name="password-confirm" autocomplete="new-password">
                </div>
                <div id="password-setup-error" class="form-error" style="display: none;"></div>
                <div class="buttons">
                    <button type="button" class="secondary" onclick="window.Strom.UI.closePasswordSetupDialog()" data-i18n="buttons.cancel">Cancel</button>
                    <button type="submit" class="primary" data-i18n="buttons.save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Password Dialog (password for export) -->
    <div class="modal-overlay" id="export-password-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="encryption.exportPassword">Export encryption</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeExportPasswordDialog()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="encryption.exportPasswordHint">Set a password to encrypt the file, or export without encryption.</p>
            <div class="form-group">
                <label data-i18n="encryption.setPassword">Set Password</label>
                <input type="password" id="export-password-input" autocomplete="off" placeholder="">
            </div>
            <div class="form-group">
                <label data-i18n="encryption.confirmPassword">Confirm Password</label>
                <input type="password" id="export-password-confirm" autocomplete="off" placeholder="">
            </div>
            <div id="export-password-error" class="form-error" style="display: none;"></div>
            <div id="export-audit-log-section" class="form-group" style="display: none;">
                <label class="settings-checkbox" style="margin-top: 8px;">
                    <input type="checkbox" id="export-audit-log-toggle">
                    <span data-i18n="auditLog.exportInclude"></span>
                </label>
            </div>
            <div class="buttons export-buttons">
                <button class="secondary" onclick="window.Strom.UI.exportWithoutPassword()" data-i18n="encryption.exportWithoutPassword">Export without encryption</button>
                <button class="primary" onclick="window.Strom.UI.confirmExportPassword()" data-i18n="encryption.exportWithPassword">Export encrypted</button>
            </div>
        </div>
    </div>

    <!-- Newer Version Warning Dialog (Storage) - No continue option -->
    <div class="modal-overlay" id="newer-version-storage-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="validation.newerDataTitle">Newer Data Version Detected</h2>
            </div>
            <div class="newer-version-content">
                <p class="warning-message" data-i18n="validation.newerDataInStorage">Your stored data was created with a newer version of the application.</p>
                <p class="warning-detail" data-i18n="validation.newerDataWarning">Opening with this older version may cause data loss or errors.</p>
                <div class="version-info">
                    <span data-i18n="validation.yourVersion">Your app version</span>: <strong id="storage-your-version">1</strong><br>
                    <span data-i18n="validation.dataVersion">Data version</span>: <strong id="storage-data-version">?</strong>
                </div>
                <p class="solution-text" data-i18n="validation.newerDataSolution">Recommended: Export your data as JSON and import it in the newer version.</p>
            </div>
            <div class="buttons">
                <button class="primary" onclick="window.Strom.UI.exportStorageAndClose()" data-i18n="validation.exportAndExit">Export JSON & Close</button>
            </div>
        </div>
    </div>

    <!-- Newer Version Warning Dialog (View Mode) - Allow viewing, no import -->
    <div class="modal-overlay" id="newer-version-viewmode-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="validation.newerDataTitle">Newer Data Version Detected</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeNewerVersionViewMode()">&times;</button>
            </div>
            <div class="newer-version-content">
                <p class="warning-message" data-i18n="validation.newerDataInImport">This file was created with a newer version of the application.</p>
                <div class="version-info">
                    <span data-i18n="validation.yourVersion">Your app version</span>: <strong id="viewmode-your-version">1</strong><br>
                    <span data-i18n="validation.dataVersion">Data version</span>: <strong id="viewmode-data-version">?</strong>
                </div>
                <p class="info-text" data-i18n="validation.viewOnlyAllowed">You can view this data, but importing is disabled to prevent data loss.</p>
            </div>
            <div class="buttons">
                <button class="primary" onclick="window.Strom.UI.viewNewerVersionData()" data-i18n="validation.viewOnly">View only (read-only)</button>
            </div>
        </div>
    </div>

    <!-- View Mode Banner -->
    <div id="view-mode-banner" class="view-mode-banner">
        <span class="view-mode-text">
            <strong data-i18n="viewMode.banner">View mode (read-only)</strong>
            <span class="view-mode-detail" data-i18n="viewMode.bannerDetail">To edit, import data to storage first.</span>
        </span>
        <div class="view-mode-actions">
            <div class="view-mode-action">
                <a id="view-mode-go-online" href="https://stromapp.info?import=from-file" target="_blank" class="btn-primary" data-i18n="viewMode.goOnline">Go to stromapp.info</a>
                <span class="view-mode-action-hint" data-i18n="viewMode.goOnlineHint">Recommended</span>
            </div>
            <div class="view-mode-action">
                <a href="#" class="view-mode-link" onclick="window.Strom.UI.importAsNew(); return false;" data-i18n="viewMode.stayOffline">Stay with this file</a>
            </div>
        </div>
    </div>

    <!-- Embedded Mode Banner -->
    <div id="embedded-mode-banner" class="embedded-mode-banner">
        <span class="embedded-mode-icon">📁</span>
        <span class="embedded-mode-text">
            <strong data-i18n="embeddedMode.banner">Standalone file</strong>
            <span class="embedded-mode-detail" data-i18n="embeddedMode.bannerDetail">This file has its own separate data storage.</span>
        </span>
        <button class="embedded-mode-info" onclick="window.Strom.UI.showEmbeddedInfoDialog()" title="Info">ℹ️</button>
        <a id="go-online-link" href="https://stromapp.info?import=from-file" target="_blank" class="embedded-mode-btn" data-i18n="embeddedMode.goOnline">stromapp.info</a>
        <button class="embedded-mode-close" onclick="window.Strom.UI.hideEmbeddedBanner()">&times;</button>
    </div>

    <!-- Embedded Mode Info Dialog -->
    <div class="modal-overlay" id="embedded-info-modal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h2 data-i18n="embeddedMode.infoTitle">About This File</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeEmbeddedInfoDialog()">&times;</button>
            </div>
            <div class="embedded-info-content">
                <p data-i18n="embeddedMode.infoText1">This is a standalone HTML file. Your data is saved in this browser's storage.</p>
                <p data-i18n="embeddedMode.infoText2">The web app at stromapp.info has its own separate storage. Data is NOT synchronized between them.</p>
                <p class="embedded-info-how"><strong data-i18n="embeddedMode.infoHow">Your options:</strong></p>
                <div class="embedded-info-option">
                    <strong data-i18n="embeddedMode.infoStayOffline">Keep using this file</strong>
                    <span class="info-text" data-i18n="embeddedMode.infoStayOfflineDesc">Your data stays in this browser. Use "Save File" to download a copy with your changes.</span>
                </div>
                <div class="embedded-info-option">
                    <strong data-i18n="embeddedMode.infoGoOnline">Switch to stromapp.info</strong>
                    <span class="info-text" data-i18n="embeddedMode.infoGoOnlineDesc">Use the web app instead. You'll need to import this file there to transfer your data.</span>
                </div>
            </div>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeEmbeddedInfoDialog()" data-i18n="buttons.close">Close</button>
                <a id="embedded-info-go-online" href="https://stromapp.info?import=from-file" target="_blank" class="btn-primary" data-i18n="embeddedMode.goOnline">stromapp.info</a>
            </div>
        </div>
    </div>

    <!-- Existing Export Dialog -->
    <div class="modal-overlay" id="existing-export-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="viewMode.existingTitle">Tree Already Exists</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeExistingExportDialog()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="viewMode.existingMessage">A tree from this export is already in your storage.</p>
            <p id="existing-export-tree-name" class="existing-tree-name"></p>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.viewStoredVersion()" data-i18n="viewMode.viewStored">View stored version</button>
                <button class="secondary" onclick="window.Strom.UI.viewEmbeddedVersion()" data-i18n="viewMode.viewEmbedded">View embedded version</button>
                <button class="primary" onclick="window.Strom.UI.updateStoredVersion()" data-i18n="viewMode.updateStored">Update storage</button>
            </div>
        </div>
    </div>

    <!-- Import from View Mode Dialog -->
    <div class="modal-overlay" id="import-view-mode-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="viewMode.importTitle">Import Tree</h2>
                <button class="close-btn" onclick="window.Strom.UI.closeImportViewModeDialog()">&times;</button>
            </div>
            <p class="modal-description" data-i18n="viewMode.importMessage">Import this tree to your local storage?</p>
            <p id="import-tree-name" class="import-tree-name"></p>
            <div class="buttons">
                <button class="secondary" onclick="window.Strom.UI.closeImportViewModeDialog()" data-i18n="buttons.cancel">Cancel</button>
                <button class="primary" onclick="window.Strom.UI.importAsNew()" data-i18n="viewMode.importButton">Import to storage</button>
            </div>
        </div>
    </div>

    <!-- Load bundled TypeScript -->
    <script src="dist/bundle.js"></script>
</body>
</html>
